<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meetings Dashboard</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 28px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .meetings-container {
            display: grid;
            gap: 20px;
        }

        .platform-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .platform-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .platform-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
        }

        .platform-name {
            font-size: 20px;
            font-weight: 600;
        }

        .platform-status {
            margin-left: auto;
            font-size: 14px;
            padding: 6px 12px;
            border-radius: 20px;
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .platform-status.disconnected {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .meetings-list {
            display: grid;
            gap: 12px;
        }

        .meeting-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
        }

        .meeting-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }

        .meeting-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .meeting-time {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 12px;
        }

        .meeting-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-join {
            background: linear-gradient(to right, #10b981, #059669);
            color: white;
        }

        .btn-join:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-copy {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-copy:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .no-meetings {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.6);
        }

        .no-meetings-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .refresh-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.02);
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        .connect-prompt {
            text-align: center;
            padding: 20px;
            color: rgba(255, 255, 255, 0.6);
        }

        .connect-btn {
            background: linear-gradient(to right, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 12px;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .connect-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="title">
            üìÖ Meetings Dashboard
        </div>
        <button class="close-btn" onclick="closeWindow()">√ó</button>
    </div>

    <div class="meetings-container" id="meetingsContainer">
        <div class="loading" id="loadingIndicator">
            üîÑ Loading your meetings...
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        let meetingsData = {};

        async function loadMeetings() {
            try {
                console.log('üìÖ Loading meetings from all platforms...');
                
                // Show loading indicator
                document.getElementById('loadingIndicator').style.display = 'block';
                
                // Get meetings from all connected platforms
                const platforms = ['googleMeet', 'teams', 'zoom', 'webex'];
                
                for (const platform of platforms) {
                    try {
                        const result = await ipcRenderer.invoke('get-platform-meetings', platform);
                        meetingsData[platform] = result;
                        console.log(`üìÖ ${platform} meetings:`, result);
                    } catch (error) {
                        console.error(`Failed to load ${platform} meetings:`, error);
                        meetingsData[platform] = { connected: false, meetings: [] };
                    }
                }
                
                // Hide loading and render meetings
                document.getElementById('loadingIndicator').style.display = 'none';
                renderMeetings();
                
            } catch (error) {
                console.error('Failed to load meetings:', error);
                document.getElementById('loadingIndicator').innerHTML = '‚ùå Failed to load meetings';
            }
        }

        function renderMeetings() {
            const container = document.getElementById('meetingsContainer');
            
            const platforms = [
                { key: 'zoom', name: 'Zoom', icon: './zoom.png' },
                { key: 'googleMeet', name: 'Google Meet', icon: './google.png' },
                { key: 'teams', name: 'Microsoft Teams', icon: './microsoft.webp' },
                { key: 'webex', name: 'Cisco Webex', icon: './webex.png' }
            ];
            
            container.innerHTML = platforms.map(platform => {
                const platformData = meetingsData[platform.key] || { connected: false, meetings: [] };
                const isConnected = platformData.connected;
                const meetings = platformData.meetings || [];
                
                return `
                    <div class="platform-section">
                        <div class="platform-header">
                            <img src="${platform.icon}" class="platform-icon" alt="${platform.name}">
                            <div class="platform-name">${platform.name}</div>
                            <div class="platform-status ${isConnected ? 'connected' : 'disconnected'}">
                                ${isConnected ? '‚úÖ Connected' : '‚ùå Not Connected'}
                            </div>
                        </div>
                        
                        ${isConnected ? renderMeetingsList(meetings, platform.key) : renderConnectPrompt(platform.key)}
                    </div>
                `;
            }).join('');
        }

        function renderMeetingsList(meetings, platformKey) {
            if (meetings.length === 0) {
                return `
                    <div class="no-meetings">
                        <div class="no-meetings-icon">üìÖ</div>
                        <div>No upcoming meetings found</div>
                        <button class="refresh-btn" onclick="refreshPlatform('${platformKey}')">
                            üîÑ Refresh Meetings
                        </button>
                    </div>
                `;
            }
            
            return `
                <div class="meetings-list">
                    ${meetings.map(meeting => `
                        <div class="meeting-card">
                            <div class="meeting-title">${meeting.title || meeting.topic || 'Untitled Meeting'}</div>
                            <div class="meeting-time">
                                üìÖ ${formatDateTime(meeting.start_time || meeting.startTime)}
                                ${meeting.duration ? `‚è±Ô∏è ${meeting.duration} min` : ''}
                            </div>
                            <div class="meeting-actions">
                                ${meeting.join_url ? `
                                    <button class="btn btn-join" onclick="joinMeeting('${meeting.join_url}')">
                                        üöÄ Join Meeting
                                    </button>
                                    <button class="btn btn-copy" onclick="copyToClipboard('${meeting.join_url}')">
                                        üìã Copy Link
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
                <button class="refresh-btn" onclick="refreshPlatform('${platformKey}')">
                    üîÑ Refresh Meetings
                </button>
            `;
        }

        function renderConnectPrompt(platformKey) {
            return `
                <div class="connect-prompt">
                    <div>Connect your account to see upcoming meetings</div>
                    <button class="connect-btn" onclick="connectPlatform('${platformKey}')">
                        üîó Connect Account
                    </button>
                </div>
            `;
        }

        function formatDateTime(dateString) {
            if (!dateString) return 'Unknown time';
            
            try {
                const date = new Date(dateString);
                return date.toLocaleString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });
            } catch (error) {
                return dateString;
            }
        }

        async function joinMeeting(url) {
            try {
                console.log('üöÄ Joining meeting:', url);
                await ipcRenderer.invoke('open-external-url', url);
            } catch (error) {
                console.error('Failed to join meeting:', error);
            }
        }

        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                // Show temporary feedback
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '‚úÖ Copied!';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            } catch (error) {
                console.error('Failed to copy to clipboard:', error);
            }
        }

        async function refreshPlatform(platformKey) {
            try {
                console.log(`üîÑ Refreshing ${platformKey} meetings...`);
                const result = await ipcRenderer.invoke('get-platform-meetings', platformKey);
                meetingsData[platformKey] = result;
                renderMeetings();
            } catch (error) {
                console.error(`Failed to refresh ${platformKey} meetings:`, error);
            }
        }

        async function connectPlatform(platformKey) {
            try {
                console.log(`üîó Opening settings to connect ${platformKey}...`);
                await ipcRenderer.invoke('show-settings-tab', 'platforms');
            } catch (error) {
                console.error(`Failed to open settings:`, error);
                // Fallback: just open settings
                ipcRenderer.send('show-settings');
            }
        }

        function closeWindow() {
            ipcRenderer.send('close-meetings-panel');
        }

        // Load meetings when the window opens
        window.addEventListener('DOMContentLoaded', () => {
            loadMeetings();
        });

        // Refresh meetings every 5 minutes
        setInterval(loadMeetings, 5 * 60 * 1000);
    </script>
</body>
</html>
