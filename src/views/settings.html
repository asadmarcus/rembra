<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Rembra</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, 
                rgba(16, 24, 40, 0.249) 0%, 
                rgba(31, 41, 55, 0.9) 25%,
                rgba(17, 24, 39, 0.95) 50%,
                rgba(30, 41, 59, 0.9) 75%,
                rgba(15, 23, 42, 0.95) 100%);
            color: #f8fafc;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            font-weight: 400;
            letter-spacing: -0.01em;
        }

        .settings-container {
            display: flex;
            width: 800px;
            height: 550px;
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(16px);
            border-radius: 16px;
            box-shadow: 
                0 32px 64px rgba(0, 0, 0, 0),
                0 0 0 1px rgba(255, 255, 255, 0),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.12);
            position: relative;
        }

        .settings-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
        }

        .sidebar {
            width: 240px;
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(8px);
            padding: 24px 20px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(180deg, 
                rgba(255, 255, 255, 0.02) 0%,
                rgba(255, 255, 255, 0.01) 50%,
                rgba(0, 0, 0, 0.02) 100%);
            pointer-events: none;
        }

        .header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            position: relative;
            z-index: 1;
        }

        .logo {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .header h1 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #f1f5f9;
            letter-spacing: -0.02em;
        }

        .header p {
            margin: 0;
            font-size: 13px;
            color: #94a3b8;
            font-weight: 400;
        }

        .header-text h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
        }

        .header-text p {
            margin: 2px 0 0 0;
            font-size: 11px;
            color: #8e8e93;
        }

        .user-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(8px);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .user-details h4 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
            color: #ffffff;
            max-width: 140px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .user-details p {
            margin: 2px 0 0 0;
            font-size: 11px;
            color: #cbd5e1;
        }

        .sign-out-btn {
            width: 100%;
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #ffffff;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sign-out-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            color: #ffffff;
            transform: translateY(-1px);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 6px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
            font-weight: 500;
            position: relative;
            z-index: 1;
            border: 1px solid transparent;
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(8px);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        .nav-item:hover:not(.active) {
            background: rgba(255, 255, 255, 0.04);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            transform: translateX(2px);
        }

        .nav-icon {
            width: 16px;
            font-size: 14px;
        }

        .nav-container {
            flex: 1;
            overflow-y: auto;
            padding-right: 4px;
            margin-right: -4px;
        }

        .nav-container::-webkit-scrollbar {
            width: 4px;
        }

        .nav-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .nav-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }

        .nav-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.01);
            backdrop-filter: blur(8px);
        }

        .content-header {
            padding: 24px 28px;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            display: flex;
            justify-content: space-between;
            align-items: center;
            -webkit-app-region: drag;
            position: relative;
        }

        .content-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.08), 
                transparent);
        }

        .content-title h2 {
            margin: 0 0 4px 0;
            font-size: 24px;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: -0.02em;
        }

        .content-title p {
            margin: 0;
            font-size: 14px;
            color: #cbd5e1;
            font-weight: 400;
        }

        .close-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            color: #cbd5e1;
            -webkit-app-region: no-drag;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .close-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.2);
            color: #ff6b6b;
            transform: scale(1.05);
        }

        .content-body {
            flex: 1;
            padding: 24px 28px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.01);
        }

        .section {
            margin-bottom: 24px;
        }

        .section h3 {
            margin: 0 0 12px 0;
            font-size: 16px;
            font-weight: 600;
            color: #e5e5e7;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(58, 58, 60, 0.6);
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .setting-info {
            flex: 1;
        }

        .setting-label {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .setting-description {
            font-size: 12px;
            color: #8e8e93;
        }

        .toggle {
            width: 44px;
            height: 24px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .toggle.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
        }

        .toggle-slider {
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(4px);
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.2),
                0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        .toggle.active .toggle-slider {
            transform: translateX(20px);
            background: rgba(255, 255, 255, 1);
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.2);
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid #007AFF;
            border-radius: 6px;
            background: #007AFF;
            color: white;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #0056CC;
        }

        .btn-secondary {
            background: transparent;
            color: #007AFF;
        }

        .btn-secondary:hover {
            background: rgba(0, 122, 255, 0.1);
        }

        .btn-danger {
            background: #FF3B30;
            border-color: #FF3B30;
        }

        .btn-danger:hover {
            background: #D70015;
        }

        .select {
            padding: 6px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(58, 58, 60, 0.8);
            color: #e5e5e7;
            font-size: 12px;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #8e8e93;
        }

        .error {
            color: #FF3B30;
            font-size: 12px;
            margin-top: 4px;
        }

        .success {
            color: #34C759;
            font-size: 12px;
            margin-top: 4px;
        }

        /* Modal styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: rgba(28, 28, 30, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 24px;
            width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            color: #e5e5e7;
        }

        .modal h3 {
            margin: 0 0 16px 0;
            font-size: 18px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 4px;
            font-size: 14px;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
            background: rgba(58, 58, 60, 0.8);
            color: #e5e5e7;
        }

        .form-input:focus {
            outline: none;
            border-color: #007AFF;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* Sessions Styles - Minimal Professional */
        .sessions-container {
            max-height: 500px;
            overflow-y: auto;
            padding: 0;
        }

        .sessions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #333;
        }

        .sessions-stats {
            font-size: 13px;
            color: #666;
        }

        .sessions-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 11px;
            border: 1px solid #444;
            background: transparent;
            color: #ccc;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .btn-small:hover {
            background: #333;
            color: #fff;
        }

        .btn-small.danger {
            border-color: #666;
            color: #999;
        }

        .btn-small.danger:hover {
            background: #444;
            color: #fff;
        }

        .session-item {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .session-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
        }

        .session-item:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(255, 255, 255, 0.08);
        }

        .session-content {
            position: relative;
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0;
            padding-right: 50px; /* More space for delete button */
        }

        .session-title {
            font-weight: 500;
            color: #fff;
            font-size: 13px;
            margin: 0;
            flex: 1;
            margin-right: 12px;
        }

        .session-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
            min-width: 80px;
        }

        .session-date {
            color: #666;
            font-size: 11px;
        }

        .session-duration {
            background: #333;
            color: #ccc;
            padding: 2px 6px;
            font-size: 10px;
            border: 1px solid #444;
            border-radius: 3px;
        }

        .session-summary-preview {
            background: #111;
            border: 1px solid #333;
            padding: 8px;
            font-size: 11px;
            color: #666;
            line-height: 1.3;
            border-radius: 3px;
        }

        .session-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            opacity: 0;
            transition: opacity 0.15s ease;
            z-index: 10;
        }

        .session-item:hover .session-actions {
            opacity: 1;
        }

        .session-action-btn {
            width: 28px;
            height: 28px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 8px;
            color: #cbd5e1;
        }

        .session-action-btn.delete {
            border-color: rgba(255, 255, 255, 0.2);
            color: #f1f5f9;
        }

        .session-action-btn.delete:hover {
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            transform: scale(1.1);
        }

        .session-action-btn.delete {
            color: #666;
        }

        .session-action-btn.delete:hover {
            background: #333;
            color: #999;
        }

        .session-action-btn.export {
            color: #666;
        }

        .session-action-btn.export:hover {
            background: #333;
            color: #999;
        }

        .sessions-empty {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .sessions-empty h4 {
            margin: 0 0 4px 0;
            color: #999;
            font-size: 13px;
            font-weight: 500;
        }

        .sessions-empty p {
            margin: 0;
            font-size: 11px;
        }

        .sessions-loading {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .loading-spinner {
            width: 16px;
            height: 16px;
            border: 1px solid #333;
            border-top: 1px solid #666;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .bulk-actions-bar {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 8px 12px;
            margin-bottom: 8px;
            display: none;
            align-items: center;
            gap: 8px;
        }

        .bulk-actions-bar.visible {
            display: flex;
        }

        .bulk-actions-info {
            flex: 1;
            color: #666;
            font-size: 11px;
        }

        .bulk-actions-buttons {
            display: flex;
            gap: 4px;
        }

        .session-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            animation: modalFadeIn 0.3s ease-out forwards;
        }

        @keyframes modalFadeIn {
            to {
                opacity: 1;
            }
        }

        .session-modal-content {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 
                0 32px 64px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transform: scale(0.9);
            animation: modalScaleIn 0.3s ease-out forwards;
        }

        @keyframes modalScaleIn {
            to {
                transform: scale(1);
            }
        }

        .session-modal-header {
            padding: 24px 28px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            background: rgba(255, 255, 255, 0.02);
        }

        .session-modal-header h3 {
            color: #ffffff;
            font-size: 20px;
            font-weight: 600;
            margin: 0;
            line-height: 1.3;
        }

        .session-modal-header .session-date {
            color: #94a3b8;
            font-size: 14px;
            font-weight: 400;
            margin-top: 4px;
        }

        .session-modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 28px;
            background: rgba(255, 255, 255, 0.01);
        }

        .session-section {
            margin-bottom: 32px;
        }

        .session-section:last-child {
            margin-bottom: 0;
        }

        .session-section h4 {
            color: #e2e8f0;
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 16px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .session-section h4::before {
            content: '';
            width: 4px;
            height: 16px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }

        .session-transcript {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
            max-height: 250px;
            overflow-y: auto;
            color: #cbd5e1;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .session-summary {
            background: rgba(255, 255, 255, 0.04);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            white-space: pre-wrap;
            line-height: 1.6;
            font-size: 14px;
            color: #e2e8f0;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .modal-close-btn {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            color: #cbd5e1;
            font-size: 16px;
            cursor: pointer;
            padding: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.25);
            color: #ffffff;
            transform: scale(1.05);
        }

        .session-modal-footer {
            padding: 20px 28px 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.02);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .session-action-button {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            color: #e2e8f0;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .session-action-button:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.25);
            color: #ffffff;
            transform: translateY(-1px);
        }

        .session-action-button.danger {
            border-color: rgba(255, 255, 255, 0.2);
        }

        .session-action-button.danger:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        /* Scrollbar Styling */
        .sessions-container::-webkit-scrollbar,
        .session-transcript::-webkit-scrollbar {
            width: 6px;
        }

        .sessions-container::-webkit-scrollbar-track,
        .session-transcript::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .sessions-container::-webkit-scrollbar-thumb,
        .session-transcript::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .sessions-container::-webkit-scrollbar-thumb:hover,
        .session-transcript::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Client Management Styles */
        .clients-container {
            max-height: 500px;
            overflow-y: auto;
            padding: 0;
        }

        .clients-loading {
            text-align: center;
            padding: 40px 20px;
            color: #94a3b8;
        }

        .clients-empty {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        .clients-empty h4 {
            margin: 0 0 8px 0;
            color: #e2e8f0;
            font-size: 16px;
            font-weight: 600;
        }

        .clients-empty p {
            margin: 0 0 20px 0;
            font-size: 14px;
        }

        .client-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .client-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
        }

        .client-card:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(255, 255, 255, 0.08);
        }

        .client-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .client-info {
            flex: 1;
        }

        .client-avatar {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 12px;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .client-name {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            margin: 0 0 4px 0;
        }

        .client-company {
            font-size: 14px;
            color: #94a3b8;
            margin: 0 0 4px 0;
        }

        .client-email {
            font-size: 12px;
            color: #64748b;
            margin: 0;
        }

        .client-stats {
            display: flex;
            gap: 16px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
        }

        .client-stat {
            text-align: center;
        }

        .client-stat-value {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 4px;
        }

        .client-stat-label {
            font-size: 11px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .client-actions {
            position: absolute;
            top: 16px;
            right: 16px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .client-card:hover .client-actions {
            opacity: 1;
        }

        .client-action-btn {
            width: 32px;
            height: 32px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(8px);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #cbd5e1;
        }

        .client-action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.25);
            color: #ffffff;
            transform: scale(1.05);
        }

        .client-action-btn.edit:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.4);
            color: #60a5fa;
        }

        .client-action-btn.delete:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.4);
            color: #f87171;
        }

        /* Brief History Styles */
        .briefs-container {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 8px;
        }

        .brief-item {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .brief-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .brief-item:last-child {
            margin-bottom: 0;
        }

        .brief-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .brief-header h5 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
            color: #ffffff;
            flex: 1;
        }

        .brief-date {
            font-size: 11px;
            color: #94a3b8;
            margin-left: 12px;
        }

        .brief-objective {
            margin: 0 0 8px 0;
            font-size: 12px;
            color: #cbd5e1;
            line-height: 1.4;
        }

        .brief-topic {
            display: inline-block;
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
            margin-right: 4px;
        }

        .brief-followup {
            display: inline-block;
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
        }

        /* Usage & Billing Styles */
        .beta-badge {
            background: rgba(255, 149, 0, 0.2);
            color: #FF9500;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid rgba(255, 149, 0, 0.3);
        }

        .usage-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .usage-card:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }

        .usage-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .usage-title {
            font-weight: 600;
            font-size: 14px;
            color: #ffffff;
        }

        .usage-stats {
            font-size: 12px;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        .usage-progress {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 6px;
        }

        .usage-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 4px;
        }

        .usage-progress-bar.warning {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .usage-progress-bar.danger {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .usage-percentage {
            font-size: 10px;
            color: #60a5fa;
            font-weight: 500;
        }

        .upgrade-card {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-top: 24px;
        }

        .upgrade-card h4 {
            margin: 0 0 8px 0;
            color: #60a5fa;
            font-size: 16px;
            font-weight: 600;
        }

        .upgrade-card p {
            margin: 0 0 16px 0;
            font-size: 14px;
            color: #cbd5e1;
            line-height: 1.5;
        }

        .subscription-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .subscription-modal-content {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            overflow-y: auto;
            padding: 28px;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .plan-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .plan-card.featured {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
            border-color: rgba(59, 130, 246, 0.4);
            transform: scale(1.02);
        }

        .plan-card:hover {
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .plan-badge {
            position: absolute;
            top: -8px;
            right: 20px;
            background: #3b82f6;
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .plan-name {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .plan-price {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 16px;
        }

        .plan-price-period {
            font-size: 14px;
            color: #94a3b8;
            font-weight: 400;
        }

        .plan-features {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .plan-features li {
            padding: 6px 0;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .plan-features li.included {
            color: #e2e8f0;
        }

        .plan-features li.excluded {
            color: #64748b;
        }

        /* Meetings Styles */
        .meeting-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }

        .meeting-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .meeting-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .meeting-title {
            font-size: 16px;
            font-weight: 600;
            color: #f8fafc;
            margin: 0 0 4px 0;
        }

        .meeting-platform {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        .meeting-platform.google-meet {
            background: rgba(66, 133, 244, 0.2);
            color: #4285f4;
        }

        .meeting-platform.microsoft-teams {
            background: rgba(101, 104, 175, 0.2);
            color: #6564af;
        }

        .meeting-platform.zoom {
            background: rgba(45, 140, 255, 0.2);
            color: #2d8cff;
        }

        .meeting-platform.webex {
            background: rgba(15, 206, 143, 0.2);
            color: #0fce8f;
        }

        .meeting-time {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            margin-bottom: 12px;
        }

        .meeting-actions {
            display: flex;
            gap: 8px;
        }

        .meeting-btn {
            padding: 8px 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #f8fafc;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .meeting-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .meeting-btn.primary {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            border: 1px solid rgba(74, 222, 128, 0.3);
            color: white;
        }

        .meeting-btn.primary:hover {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .loading-state {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        .loading-state i {
            font-size: 24px;
            margin-bottom: 12px;
            color: rgba(255, 255, 255, 0.5);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            color: rgba(255, 255, 255, 0.3);
        }

        .platform-section {
            margin-bottom: 24px;
        }

        .platform-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .platform-icon {
            width: 20px;
            height: 20px;
        }

        .platform-name {
            font-size: 14px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }
    </style>
</head>

<body>
    <div class="settings-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="header">
                <div class="logo">
                    <svg width="28" height="28" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(12, 12)">
                            <!-- Top line (longest) -->
                            <rect x="-10" y="-4" width="20" height="1.5" rx="0.75" fill="currentColor" opacity="1"/>
                            
                            <!-- Middle line -->
                            <rect x="-7" y="-0.75" width="14" height="1.5" rx="0.75" fill="currentColor" opacity="0.9"/>
                            
                            <!-- Bottom line (shortest) -->
                            <rect x="-4" y="2.5" width="8" height="1.5" rx="0.75" fill="currentColor" opacity="0.7"/>
                        </g>
                    </svg>
                </div>
                <div class="header-text">
                    <h3>Rembra</h3>
                    <p>Settings</p>
                </div>
            </div>

            <div class="user-card">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">?</div>
                    <div class="user-details">
                        <h4 id="userName">Loading...</h4>
                        <p id="userEmail">Loading...</p>
                    </div>
                </div>
                <button class="sign-out-btn" id="authButton" onclick="handleAuthAction()">Sign Out</button>
            </div>

            <nav class="nav-container">
                <div class="nav-item active" onclick="switchTab('privacy')">
                    <span class="nav-icon">⚙</span>
                    Privacy & Settings
                </div>
                <div class="nav-item" onclick="switchTab('integrations')">
                    <span class="nav-icon">⇋</span>
                    Meeting Platforms
                </div>
                <div class="nav-item" onclick="switchTab('meetings')">
                    <span class="nav-icon">📅</span>
                    My Meetings
                </div>
                <div class="nav-item" onclick="switchTab('usage')">
                    <span class="nav-icon">≡</span>
                    Usage & Billing
                </div>
                <div class="nav-item" onclick="switchTab('sessions')">
                    <span class="nav-icon">●</span>
                    Sessions
                </div>
                <div class="nav-item" onclick="switchTab('clients')">
                    <span class="nav-icon">◉</span>
                    Clients
                </div>
                <div class="nav-item" onclick="switchTab('account')">
                    <span class="nav-icon">△</span>
                    Account
                </div>
                <div class="nav-item" onclick="switchTab('about')">
                    <span class="nav-icon">i</span>
                    About
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="content-header">
                <div class="content-title">
                    <h2 id="contentTitle">General</h2>
                    <p id="contentSubtitle">App preferences and settings</p>
                </div>
                <button class="close-btn" onclick="closeSettings()">×</button>
            </div>

            <div class="content-body" id="contentBody">
                <!-- Content will be dynamically loaded here -->
            </div>
        </div>
    </div>

    <!-- Change Email Modal -->
    <div class="modal" id="changeEmailModal">
        <div class="modal-content">
            <h3>Change Email</h3>
            <form id="changeEmailForm">
                <div class="form-group">
                    <label class="form-label" for="newEmail">New Email</label>
                    <input type="email" class="form-input" id="newEmail" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="currentPassword">Current Password</label>
                    <input type="password" class="form-input" id="currentPassword" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('changeEmailModal')">Cancel</button>
                    <button type="submit" class="btn">Update Email</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content">
            <h3>Change Password</h3>
            <form id="changePasswordForm">
                <div class="form-group">
                    <label class="form-label" for="currentPasswordChange">Current Password</label>
                    <input type="password" class="form-input" id="currentPasswordChange" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="newPassword">New Password</label>
                    <input type="password" class="form-input" id="newPassword" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="confirmPassword">Confirm New Password</label>
                    <input type="password" class="form-input" id="confirmPassword" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('changePasswordModal')">Cancel</button>
                    <button type="submit" class="btn">Update Password</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Client Modal -->
    <div class="modal" id="addClientModal">
        <div class="modal-content">
            <h3>Add New Client</h3>
            <form id="addClientForm">
                <div class="form-group">
                    <label class="form-label" for="clientName">Client Name *</label>
                    <input type="text" id="clientName" class="form-input" placeholder="Enter client name" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="clientCompany">Company</label>
                    <input type="text" id="clientCompany" class="form-input" placeholder="Enter company name">
                </div>
                <div class="form-group">
                    <label class="form-label" for="clientEmail">Email</label>
                    <input type="email" id="clientEmail" class="form-input" placeholder="Enter email address">
                </div>
                <div class="form-group">
                    <label class="form-label" for="clientPhone">Phone</label>
                    <input type="tel" id="clientPhone" class="form-input" placeholder="Enter phone number">
                </div>
                <div class="form-group">
                    <label class="form-label" for="clientNotes">Notes</label>
                    <textarea id="clientNotes" class="form-input" placeholder="Additional notes about this client" rows="3" style="resize: vertical; min-height: 60px; font-family: inherit;"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addClientModal')">Cancel</button>
                    <button type="submit" class="btn">Add Client</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Client Modal -->
    <div class="modal" id="editClientModal">
        <div class="modal-content">
            <h3>Edit Client</h3>
            <form id="editClientForm">
                <input type="hidden" id="editClientId">
                <div class="form-group">
                    <label class="form-label" for="editClientName">Client Name *</label>
                    <input type="text" id="editClientName" class="form-input" placeholder="Enter client name" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editClientCompany">Company</label>
                    <input type="text" id="editClientCompany" class="form-input" placeholder="Enter company name">
                </div>
                <div class="form-group">
                    <label class="form-label" for="editClientEmail">Email</label>
                    <input type="email" id="editClientEmail" class="form-input" placeholder="Enter email address">
                </div>
                <div class="form-group">
                    <label class="form-label" for="editClientPhone">Phone</label>
                    <input type="tel" id="editClientPhone" class="form-input" placeholder="Enter phone number">
                </div>
                <div class="form-group">
                    <label class="form-label" for="editClientNotes">Notes</label>
                    <textarea id="editClientNotes" class="form-input" placeholder="Additional notes about this client" rows="3" style="resize: vertical; min-height: 60px; font-family: inherit;"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editClientModal')">Cancel</button>
                    <button type="submit" class="btn">Update Client</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        let currentTab = 'general';
        let currentUser = null;

        // Tab content templates
        const tabContent = {
            usage: {
                title: 'Usage & Billing',
                subtitle: 'Track your usage and manage subscription',
                content: `
                    <div class="section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>Beta Usage Limits</h3>
                            <span class="beta-badge">BETA ACCESS</span>
                        </div>
                        
                        <div id="usageCards">
                            <!-- Usage cards will be dynamically loaded -->
                        </div>

                        <div class="upgrade-card">
                            <h4>Ready to Upgrade?</h4>
                            <p>Get unlimited access to all Rembra features with our upcoming subscription plans. During the beta period, enjoy all premium features for free!</p>
                            <button class="btn" onclick="showSubscriptionPlans()">View Subscription Plans</button>
                        </div>
                    </div>
                `
            },
            integrations: {
                title: 'Meeting Platform Integrations',
                subtitle: 'Connect with Google Meet, Teams, Zoom for seamless meeting management',
                content: `
                    <div class="section">
                        <h3>Available Platforms</h3>
                        <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 20px;">
                            Connect your meeting platforms to automatically fetch meeting details, participants, and topics. 
                            Rembra can join meetings and start recording automatically.
                        </p>
                        
                        <div id="platformsList">
                            <!-- Platforms will be dynamically loaded -->
                        </div>
                    </div>

                    <div class="section">
                        <h3>Quick Meeting Join</h3>
                        <div class="setting-item" style="flex-direction: column; align-items: stretch;">
                            <div style="margin-bottom: 12px;">
                                <div class="setting-label">Meeting URL</div>
                                <div class="setting-description">Paste any meeting URL to join and start recording</div>
                            </div>
                            <div style="display: flex; gap: 12px;">
                                <input type="text" id="meetingUrlInput" placeholder="https://meet.google.com/xyz-abc-def" 
                                       style="flex: 1; padding: 8px 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(255,255,255,0.1); color: white;">
                                <button class="btn" onclick="joinMeetingFromUrl()" style="padding: 8px 16px;">Join & Record</button>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Auto-Recording Settings</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Auto-start recording</div>
                                <div class="setting-description">Automatically start recording when joining meetings</div>
                            </div>
                            <div class="toggle active" onclick="toggleSetting(this, 'autoStartRecording')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Auto-generate briefs</div>
                                <div class="setting-description">Automatically create meeting briefs from platform data</div>
                            </div>
                            <div class="toggle active" onclick="toggleSetting(this, 'autoGenerateBriefs')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>
                `
            },
            meetings: {
                title: 'My Meetings',
                subtitle: 'View and manage your upcoming meetings from connected platforms',
                content: `
                    <div class="section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>Upcoming Meetings</h3>
                            <button class="btn" onclick="refreshMeetings()" style="padding: 8px 16px;">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        
                        <div id="meetingsList">
                            <!-- Meetings will be dynamically loaded -->
                            <div class="loading-state">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Loading meetings...</p>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Quick Actions</h3>
                        <div class="setting-item" style="flex-direction: column; align-items: stretch;">
                            <div style="margin-bottom: 12px;">
                                <div class="setting-label">Join Meeting URL</div>
                                <div class="setting-description">Paste any meeting URL to join quickly</div>
                            </div>
                            <div style="display: flex; gap: 12px;">
                                <input type="text" id="quickJoinUrl" placeholder="https://meet.google.com/xyz-abc-def" 
                                       style="flex: 1; padding: 8px 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(255,255,255,0.1); color: white;">
                                <button class="btn" onclick="quickJoinMeeting()" style="padding: 8px 16px;">Join</button>
                            </div>
                        </div>
                    </div>
                `
            },
            privacy: {
                title: 'Privacy & Settings',
                subtitle: 'App preferences, audio settings, privacy and security',
                content: `
                    <div class="section">
                        <h3>Appearance & Behavior</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Launch at startup</div>
                                <div class="setting-description">Automatically start Rembra when you log in</div>
                            </div>
                            <div class="toggle" onclick="toggleSetting(this, 'launchAtStartup')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Show notifications</div>
                                <div class="setting-description">Get notified when meetings start or end</div>
                            </div>
                            <div class="toggle active" onclick="toggleSetting(this, 'notifications')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Recording Settings</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Auto-save recordings</div>
                                <div class="setting-description">Automatically save recordings to your chosen folder</div>
                            </div>
                            <div class="toggle active" onclick="toggleSetting(this, 'autoSave')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Recording quality</div>
                                <div class="setting-description">Choose audio recording quality</div>
                            </div>
                            <select class="select" onchange="updateSetting('recordingQuality', this.value)">
                                <option value="high">High Quality</option>
                                <option value="medium" selected>Medium Quality</option>
                                <option value="low">Low Quality</option>
                            </select>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Audio Sources</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Enable microphone</div>
                                <div class="setting-description">Record from your microphone</div>
                            </div>
                            <div class="toggle active" onclick="toggleSetting(this, 'microphone')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Enable system audio</div>
                                <div class="setting-description">Record system audio and applications</div>
                            </div>
                            <div class="toggle" onclick="toggleSetting(this, 'systemAudio')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Audio Processing</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Noise reduction</div>
                                <div class="setting-description">Reduce background noise in recordings</div>
                            </div>
                            <div class="toggle active" onclick="toggleSetting(this, 'noiseReduction')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Echo cancellation</div>
                                <div class="setting-description">Cancel echo and feedback</div>
                            </div>
                            <div class="toggle active" onclick="toggleSetting(this, 'echoCancellation')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Data Collection</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Analytics</div>
                                <div class="setting-description">Help improve Rembra by sharing anonymous usage data</div>
                            </div>
                            <div class="toggle" onclick="toggleSetting(this, 'analytics')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Crash reports</div>
                                <div class="setting-description">Automatically send crash reports to help fix bugs</div>
                            </div>
                            <div class="toggle active" onclick="toggleSetting(this, 'crashReports')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Content Protection</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Screen recording protection</div>
                                <div class="setting-description">Prevent screenshots and screen recordings of Rembra</div>
                            </div>
                            <div class="toggle" id="contentProtectionToggle" onclick="toggleContentProtection(this)">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Data Management</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Local data storage</div>
                                <div class="setting-description">Manage your local recordings and data</div>
                            </div>
                            <button class="btn btn-secondary" onclick="openDataFolder()">Open Folder</button>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Clear all data</div>
                                <div class="setting-description">Remove all recordings and settings from this device</div>
                            </div>
                            <button class="btn btn-danger" onclick="clearAllData()">Clear Data</button>
                        </div>
                    </div>
                `
            },
            account: {
                title: 'Account',
                subtitle: 'Manage your account and authentication',
                content: `
                    <div class="section">
                        <h3>Profile Information</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Email</div>
                                <div class="setting-description" id="accountEmail">Loading...</div>
                            </div>
                            <button class="btn btn-secondary" onclick="showChangeEmailModal()">Change</button>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Password</div>
                                <div class="setting-description">••••••••••••</div>
                            </div>
                            <button class="btn btn-secondary" onclick="showChangePasswordModal()">Change</button>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Account Management</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">User ID</div>
                                <div class="setting-description" id="accountUserId">Loading...</div>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Send password reset</div>
                                <div class="setting-description">Send a password reset email</div>
                            </div>
                            <button class="btn btn-secondary" onclick="sendPasswordReset()">Send Reset</button>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Danger Zone</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Delete account</div>
                                <div class="setting-description">Permanently delete your account and all data</div>
                            </div>
                            <button class="btn btn-danger" onclick="confirmDeleteAccount()">Delete Account</button>
                        </div>
                    </div>
                `
            },
            about: {
                title: 'About',
                subtitle: 'App information and support',
                content: `
                    <div class="section">
                        <h3>Application</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Version</div>
                                <div class="setting-description">1.0.0 (Beta)</div>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Build</div>
                                <div class="setting-description">2024.1.1</div>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Check for updates</div>
                                <div class="setting-description">Check if a newer version is available</div>
                            </div>
                            <button class="btn btn-secondary" onclick="checkForUpdates()">Check Now</button>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Support</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Documentation</div>
                                <div class="setting-description">Learn how to use Rembra effectively</div>
                            </div>
                            <button class="btn btn-secondary" onclick="openDocumentation()">Open Docs</button>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Contact support</div>
                                <div class="setting-description">Get help with issues or questions</div>
                            </div>
                            <button class="btn btn-secondary" onclick="contactSupport()">Contact Us</button>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Send feedback</div>
                                <div class="setting-description">Share your thoughts and suggestions</div>
                            </div>
                            <button class="btn btn-secondary" onclick="sendFeedback()">Send Feedback</button>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Legal</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Privacy Policy</div>
                                <div class="setting-description">How we handle your data</div>
                            </div>
                            <button class="btn btn-secondary" onclick="openPrivacyPolicy()">View</button>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Terms of Service</div>
                                <div class="setting-description">Terms and conditions</div>
                            </div>
                            <button class="btn btn-secondary" onclick="openTermsOfService()">View</button>
                        </div>
                    </div>
                `
            },
            sessions: {
                title: 'Sessions',
                subtitle: 'Meeting transcription history',
                content: `
                    <div class="section">
                        <div class="sessions-header">
                            <div class="sessions-stats">
                                <span id="total-sessions">0 sessions</span>
                                <span id="total-duration">0 min</span>
                                <span id="total-words">0 words</span>
                            </div>
                            <div class="sessions-actions">
                                <button class="btn-small" onclick="exportAllSessions()">Export All</button>
                                <button class="btn-small" onclick="selectAllSessions()">Select All</button>
                                <button class="btn-small danger" onclick="clearAllSessions()">Clear All</button>
                            </div>
                        </div>

                        <div class="bulk-actions-bar" id="bulk-actions-bar">
                            <div class="bulk-actions-info">
                                <span id="selected-count">0</span> selected
                            </div>
                            <div class="bulk-actions-buttons">
                                <button class="btn-small" onclick="exportSelectedSessions()">Export</button>
                                <button class="btn-small danger" onclick="deleteSelectedSessions()">Delete</button>
                                <button class="btn-small" onclick="clearSelection()">Clear</button>
                            </div>
                        </div>
                        
                        <div class="sessions-container" id="sessionsContainer">
                            <div class="sessions-loading">
                                <div class="loading-spinner"></div>
                                <p>Loading sessions...</p>
                            </div>
                        </div>
                    </div>
                `
            },
            clients: {
                title: 'Clients',
                subtitle: 'Manage your client information',
                content: `
                    <div class="section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h3>Client Management</h3>
                            <button class="btn btn-secondary" onclick="showAddClientModal()">Add Client</button>
                        </div>
                        <p style="color: #94a3b8; margin-bottom: 20px; font-size: 14px;">Manage your clients for personalized meeting briefs and better organization</p>
                        <div id="clientsList">
                            <div class="clients-loading">
                                <div class="loading-spinner"></div>
                                <p>Loading clients...</p>
                            </div>
                        </div>
                    </div>
                `
            }
        };

        function switchTab(tab) {
            currentTab = tab;

            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');

            // Update content
            const content = tabContent[tab];
            document.getElementById('contentTitle').textContent = content.title;
            document.getElementById('contentSubtitle').textContent = content.subtitle;
            document.getElementById('contentBody').innerHTML = content.content;

            // Load specific tab data
            if (tab === 'account') {
                loadUserData();
            } else if (tab === 'privacy') {
                loadPrivacySettings();
            } else if (tab === 'integrations') {
                loadPlatforms();
            } else if (tab === 'meetings') {
                loadMeetings();
            } else if (tab === 'sessions') {
                loadSessions();
            } else if (tab === 'clients') {
                loadClients();
            } else if (tab === 'usage') {
                loadUsageData();
            }
        }

        function toggleSetting(toggle, settingKey) {
            toggle.classList.toggle('active');
            const isEnabled = toggle.classList.contains('active');
            
            // Save setting to backend
            ipcRenderer.invoke('update-setting', settingKey, isEnabled)
                .then(() => {
                    console.log(`Setting ${settingKey} updated to ${isEnabled}`);
                })
                .catch(error => {
                    console.error('Failed to update setting:', error);
                    // Revert toggle on error
                    toggle.classList.toggle('active');
                });
        }

        async function toggleContentProtection(toggle) {
            try {
                const isEnabled = !toggle.classList.contains('active');
                const result = await ipcRenderer.invoke('set-content-protection', isEnabled);
                
                if (result.success) {
                    toggle.classList.toggle('active', isEnabled);
                } else {
                    console.error('Failed to update content protection:', result.error);
                }
            } catch (error) {
                console.error('Error toggling content protection:', error);
            }
        }

        function updateSetting(settingKey, value) {
            ipcRenderer.invoke('update-setting', settingKey, value)
                .then(() => {
                    console.log(`Setting ${settingKey} updated to ${value}`);
                })
                .catch(error => {
                    console.error('Failed to update setting:', error);
                });
        }

        async function loadUserData() {
            console.log('Loading user data...');
            try {
                const userData = await ipcRenderer.invoke('get-user-data');
                console.log('User data response:', userData);
                
                if (userData.success && userData.user) {
                    currentUser = userData.user;
                    console.log('User data loaded successfully:', currentUser);
                    
                    // Update user card for signed-in user
                    document.getElementById('userAvatar').textContent = getUserInitials(userData.user.email);
                    document.getElementById('userName').textContent = getUserDisplayName(userData.user.email);
                    document.getElementById('userEmail').textContent = userData.user.email;
                    
                    // Update auth button
                    const authButton = document.getElementById('authButton');
                    authButton.textContent = 'Sign Out';
                    authButton.className = 'sign-out-btn';
                    
                    // Update account section if visible
                    const accountEmail = document.getElementById('accountEmail');
                    const accountUserId = document.getElementById('accountUserId');
                    
                    if (accountEmail) accountEmail.textContent = userData.user.email;
                    if (accountUserId) accountUserId.textContent = userData.user.uid;
                } else {
                    console.log('No user data from main process, trying Firebase...');
                    
                    // Try to get user data from Firebase directly in renderer
                    try {
                        const { getAuth } = require('firebase/auth');
                        
                        // Check if Firebase is already initialized somewhere else
                        let auth;
                        try {
                            auth = getAuth();
                            console.log('🔍 Using existing Firebase auth instance');
                        } catch (error) {
                            console.log('🔍 No existing Firebase auth, initializing...');
                            const { initializeApp } = require('firebase/app');
                            const firebaseConfig = {
                                apiKey: "AIzaSyBhoXlAxO9_YdZY9Bdsi9X3oFpJzbC-FKI",
                                authDomain: "ali-website-1674a.firebaseapp.com",
                                projectId: "ali-website-1674a",
                                storageBucket: "ali-website-1674a.firebasestorage.app",
                                messagingSenderId: "1096024812793",
                                appId: "1:1096024812793:web:14ef02289b05cd11ca4628"
                            };
                            const app = initializeApp(firebaseConfig);
                            auth = getAuth(app);
                        }
                        
                        console.log('🔍 Firebase auth object:', auth);
                        console.log('🔍 Firebase current user:', auth.currentUser);
                        
                        if (auth.currentUser) {
                            const firebaseUser = {
                                email: auth.currentUser.email,
                                uid: auth.currentUser.uid,
                                displayName: auth.currentUser.displayName || auth.currentUser.email.split('@')[0]
                            };
                            
                            console.log('Got user from Firebase renderer:', firebaseUser);
                            currentUser = firebaseUser;
                            
                            // Update user card for signed-in user
                            document.getElementById('userAvatar').textContent = getUserInitials(firebaseUser.email);
                            document.getElementById('userName').textContent = getUserDisplayName(firebaseUser.email);
                            document.getElementById('userEmail').textContent = firebaseUser.email;
                            
                            // Update auth button
                            const authButton = document.getElementById('authButton');
                            authButton.textContent = 'Sign Out';
                            authButton.className = 'sign-out-btn';
                            
                            // Update account section if visible
                            const accountEmail = document.getElementById('accountEmail');
                            const accountUserId = document.getElementById('accountUserId');
                            
                            if (accountEmail) accountEmail.textContent = firebaseUser.email;
                            if (accountUserId) accountUserId.textContent = firebaseUser.uid;
                            
                            // Store it in main process for future use
                            await ipcRenderer.invoke('auth-success', { user: firebaseUser });
                            
                            return; // Exit early, we found the user
                        } else {
                            console.log('No Firebase user found either');
                        }
                    } catch (firebaseError) {
                        console.error('Error accessing Firebase:', firebaseError);
                    }
                    
                    // If we get here, truly no user signed in OR auth session expired
                    console.log('No user signed in anywhere - may need re-authentication');
                    
                    // Check if we're supposedly authenticated but have no user data
                    const ipcResult = await ipcRenderer.invoke('get-user-data');
                    if (ipcResult.isAuthenticated && !ipcResult.user) {
                        console.log('Authentication mismatch detected - user needs to re-authenticate');
                        // Show "Re-authenticate" state
                        document.getElementById('userAvatar').textContent = '!';
                        document.getElementById('userName').textContent = 'Session Expired';
                        document.getElementById('userEmail').textContent = 'Please sign in again to continue';
                        
                        // Update auth button to re-authenticate
                        const authButton = document.getElementById('authButton');
                        authButton.textContent = 'Re-authenticate';
                        authButton.className = 'sign-out-btn'; // Same styling
                        
                        // Update account section if visible
                        const accountEmail = document.getElementById('accountEmail');
                        const accountUserId = document.getElementById('accountUserId');
                        
                        if (accountEmail) accountEmail.textContent = 'Session expired';
                        if (accountUserId) accountUserId.textContent = 'Please re-authenticate';
                    } else {
                        // Truly not signed in
                        document.getElementById('userAvatar').textContent = '?';
                        document.getElementById('userName').textContent = 'Not signed in';
                        document.getElementById('userEmail').textContent = 'Please sign in to continue';
                        
                        // Update auth button
                        const authButton = document.getElementById('authButton');
                        authButton.textContent = 'Sign In';
                        authButton.className = 'sign-out-btn'; // Same styling, different action
                        
                        // Update account section if visible
                        const accountEmail = document.getElementById('accountEmail');
                        const accountUserId = document.getElementById('accountUserId');
                        
                        if (accountEmail) accountEmail.textContent = 'Not signed in';
                        if (accountUserId) accountUserId.textContent = 'Not available';
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                document.getElementById('userName').textContent = 'Error';
                document.getElementById('userEmail').textContent = 'Failed to load';
                
                const authButton = document.getElementById('authButton');
                authButton.textContent = 'Sign In';
                authButton.className = 'sign-out-btn';
            }
        }

        // Listen for requests from main process to get user data
        ipcRenderer.on('request-user-from-firebase', async () => {
            console.log('🔍 Main process requesting user data from renderer Firebase');
            
            try {
                // Wait for Firebase to be initialized if not already
                if (!auth) {
                    console.log('⏳ Firebase not initialized yet, waiting...');
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
                
                // Try to initialize Firebase if still not ready
                if (!auth) {
                    console.log('🔧 Initializing Firebase for user data request...');
                    const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js');
                    const { getAuth, onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js');
                    
                    const firebaseConfig = {
                        apiKey: "AIzaSyDwT4ojNAV4iFiW5d5fRFIowT49qlJJQxE",
                        authDomain: "rembra-ccda7.firebaseapp.com",
                        projectId: "rembra-ccda7",
                        storageBucket: "rembra-ccda7.appspot.com",
                        messagingSenderId: "1096024812793",
                        appId: "1:1096024812793:web:14ef02289b05cd11ca4628"
                    };
                    const app = initializeApp(firebaseConfig);
                    auth = getAuth(app);
                    
                    // Wait for auth state to be determined
                    console.log('🔧 Waiting for Firebase auth state...');
                    await new Promise((resolve) => {
                        const unsubscribe = onAuthStateChanged(auth, (user) => {
                            console.log('🔍 Firebase auth state changed:', user ? 'User found' : 'No user');
                            unsubscribe();
                            resolve();
                        });
                        
                        // Timeout after 5 seconds
                        setTimeout(() => {
                            unsubscribe();
                            resolve();
                        }, 5000);
                    });
                }
                
                // Check if we have a current user
                if (auth && auth.currentUser) {
                    const userData = {
                        email: auth.currentUser.email,
                        uid: auth.currentUser.uid,
                        displayName: auth.currentUser.displayName || auth.currentUser.email.split('@')[0]
                    };
                    console.log('📤 Sending user data to main process:', userData);
                    ipcRenderer.send('user-from-renderer', userData);
                } else {
                    console.log('No current user in renderer Firebase after auth state check');
                    ipcRenderer.send('user-from-renderer', null);
                }
            } catch (error) {
                console.error('Error getting user data from renderer:', error);
                ipcRenderer.send('user-from-renderer', null);
            }
        });

        async function handleAuthAction() {
            const authButton = document.getElementById('authButton');
            const buttonText = authButton.textContent;
            
            if (buttonText === 'Sign Out') {
                // Handle sign out
                try {
                    console.log('🔓 Signing out...');
                    await ipcRenderer.invoke('logout');
                    
                    // Reload user data to reflect signed-out state
                    await loadUserData();
                } catch (error) {
                    console.error('Error signing out:', error);
                }
            } else if (buttonText === 'Re-authenticate' || buttonText === 'Sign In') {
                // Handle sign in / re-authentication
                try {
                    console.log('Opening login window...');
                    ipcRenderer.send('show-login');
                } catch (error) {
                    console.error('Error opening login:', error);
                }
            }
        }

        // Sessions management
        let selectedSessions = new Set();
        let allSessions = [];

        async function loadSessions() {
            const container = document.getElementById('sessionsContainer');
            
            try {
                const sessions = JSON.parse(localStorage.getItem('transcription_sessions') || '[]');
                console.log('DEBUG: Found sessions in localStorage:', sessions.length);
                console.log('DEBUG: First session structure:', sessions[0]);
                
                allSessions = sessions;
                
                if (sessions.length === 0) {
                    container.innerHTML = `
                        <div class="sessions-empty">
                            <h4>No sessions</h4>
                            <p>Meeting transcriptions will appear here</p>
                        </div>
                    `;
                    updateSessionsStats(0, 0, 0);
                    return;
                }

                const totalDuration = sessions.reduce((sum, s) => sum + Math.round((s.duration || 0) / 1000 / 60), 0);
                const totalWords = sessions.reduce((sum, s) => {
                    const wordCount = s.transcript ? s.transcript.reduce((count, t) => count + t.text.split(' ').length, 0) : 0;
                    return sum + wordCount;
                }, 0);
                updateSessionsStats(sessions.length, totalDuration, totalWords);
                
                const sortedSessions = sessions.sort((a, b) => new Date(b.startTime) - new Date(a.startTime));
                
                container.innerHTML = sortedSessions.map((session, index) => {
                    const date = new Date(session.startTime);
                    const duration = Math.round((session.duration || 0) / 1000 / 60);
                    
                    return `
                        <div class="session-item" data-session-id="${index}" onclick="showSessionModal(event, ${index})">
                            <div class="session-content">
                                <div class="session-header">
                                    <div class="session-title">${session.title || `Meeting ${date.toLocaleDateString()}`}</div>
                                    <div class="session-meta">
                                        <span class="session-date">${date.toLocaleDateString()} ${date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>
                                        <span class="session-duration">${duration} min</span>
                                    </div>
                                </div>
                                
                                <div class="session-actions">
                                    <button class="session-action-btn delete" onclick="deleteSession(event, ${index})" title="Delete">×</button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error loading sessions:', error);
                container.innerHTML = `
                    <div class="sessions-empty">
                        <div class="empty-icon">!</div>
                        <h4>Error loading sessions</h4>
                        <p>There was an error loading your session data.<br>Please try refreshing the page.</p>
                    </div>
                `;
            }
        }

        function updateSessionsStats(count, duration, words) {
            const totalSessionsEl = document.getElementById('total-sessions');
            const totalDurationEl = document.getElementById('total-duration');
            const totalWordsEl = document.getElementById('total-words');
            
            if (totalSessionsEl) totalSessionsEl.textContent = `${count} sessions`;
            if (totalDurationEl) totalDurationEl.textContent = `${duration} minutes`;
            if (totalWordsEl) totalWordsEl.textContent = `${words.toLocaleString()} words`;
        }

        function selectSession(event, sessionIndex) {
            // Prevent selection if clicking on checkbox or action buttons
            if (event.target.type === 'checkbox' || event.target.closest('.session-actions')) {
                return;
            }
            
            showSessionModal(sessionIndex);
        }

        function toggleSessionSelection(event, sessionIndex) {
            event.stopPropagation();
            
            const checkbox = event.target;
            const sessionItem = checkbox.closest('.session-item');
            
            if (checkbox.checked) {
                selectedSessions.add(sessionIndex);
                sessionItem.classList.add('selected');
            } else {
                selectedSessions.delete(sessionIndex);
                sessionItem.classList.remove('selected');
            }
            
            updateBulkActionsVisibility();
        }

        function updateBulkActionsVisibility() {
            const bulkActionsBar = document.getElementById('bulk-actions-bar');
            const selectedCountEl = document.getElementById('selected-count');
            
            if (bulkActionsBar && selectedCountEl) {
                if (selectedSessions.size > 0) {
                    bulkActionsBar.classList.add('visible');
                    selectedCountEl.textContent = selectedSessions.size;
                } else {
                    bulkActionsBar.classList.remove('visible');
                }
            }
        }

        function selectAllSessions() {
            const checkboxes = document.querySelectorAll('.session-checkbox');
            const shouldSelectAll = selectedSessions.size < allSessions.length;
            
            if (shouldSelectAll) {
                // Select all
                selectedSessions.clear();
                checkboxes.forEach((checkbox, index) => {
                    checkbox.checked = true;
                    checkbox.closest('.session-item').classList.add('selected');
                    selectedSessions.add(index);
                });
            } else {
                // Deselect all
                clearSelection();
            }
            
            updateBulkActionsVisibility();
        }

        function clearSelection() {
            selectedSessions.clear();
            document.querySelectorAll('.session-checkbox').forEach(checkbox => {
                checkbox.checked = false;
                checkbox.closest('.session-item').classList.remove('selected');
            });
            updateBulkActionsVisibility();
        }

        function deleteSession(event, sessionIndex) {
            event.stopPropagation();
            
            if (!confirm('Are you sure you want to delete this session? This action cannot be undone.')) {
                return;
            }
            
            try {
                const sessions = JSON.parse(localStorage.getItem('transcription_sessions') || '[]');
                sessions.splice(sessionIndex, 1);
                localStorage.setItem('transcription_sessions', JSON.stringify(sessions));
                
                loadSessions();
                showNotification('Session deleted successfully', 'success');
            } catch (error) {
                console.error('Error deleting session:', error);
                showNotification('Error deleting session', 'error');
            }
        }

        function deleteSelectedSessions() {
            if (selectedSessions.size === 0) return;
            
            const count = selectedSessions.size;
            if (!confirm(`Are you sure you want to delete ${count} selected session${count > 1 ? 's' : ''}? This action cannot be undone.`)) {
                return;
            }
            
            try {
                const sessions = JSON.parse(localStorage.getItem('transcription_sessions') || '[]');
                const sortedIndices = Array.from(selectedSessions).sort((a, b) => b - a);
                
                sortedIndices.forEach(index => {
                    sessions.splice(index, 1);
                });
                
                localStorage.setItem('transcription_sessions', JSON.stringify(sessions));
                selectedSessions.clear();
                loadSessions();
                showNotification(`${count} session${count > 1 ? 's' : ''} deleted successfully`, 'success');
            } catch (error) {
                console.error('Error deleting sessions:', error);
                showNotification('Error deleting sessions', 'error');
            }
        }

        function clearAllSessions() {
            if (allSessions.length === 0) return;
            
            if (!confirm(`Are you sure you want to delete ALL ${allSessions.length} sessions? This action cannot be undone and will permanently remove all your meeting transcriptions.`)) {
                return;
            }
            
            try {
                localStorage.removeItem('transcription_sessions');
                selectedSessions.clear();
                loadSessions();
                showNotification('All sessions cleared successfully', 'success');
            } catch (error) {
                console.error('Error clearing sessions:', error);
                showNotification('Error clearing sessions', 'error');
            }
        }

        function exportSession(event, sessionIndex) {
            event.stopPropagation();
            
            try {
                const sessions = JSON.parse(localStorage.getItem('transcription_sessions') || '[]');
                const session = sessions[sessionIndex];
                
                if (!session) {
                    showNotification('Session not found', 'error');
                    return;
                }
                
                const date = new Date(session.startTime);
                const filename = `meeting-${date.getFullYear()}-${(date.getMonth()+1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}-${date.getHours().toString().padStart(2, '0')}${date.getMinutes().toString().padStart(2, '0')}.txt`;
                
                const duration = Math.round((session.duration || 0) / 1000 / 60);
                const wordCount = session.transcript ? session.transcript.reduce((count, t) => count + t.text.split(' ').length, 0) : 0;
                const speakers = session.speakers ? session.speakers.length : 0;
                const transcript = session.transcript ? session.transcript.map(t => `${t.speaker}: ${t.text}`).join('\n\n') : 'No transcript available';
                
                const content = `Meeting Transcription - ${date.toLocaleDateString()} ${date.toLocaleTimeString()}

Duration: ${duration} minutes
Speakers: ${speakers}
Words: ${wordCount}
Audio Source: ${session.audioSourceLabel || 'Microphone'}

${session.summary ? `SUMMARY:\n${session.summary}\n\n` : ''}TRANSCRIPT:\n${transcript}
`;
                
                downloadTextFile(content, filename);
                showNotification('Session exported successfully', 'success');
            } catch (error) {
                console.error('Error exporting session:', error);
                showNotification('Error exporting session', 'error');
            }
        }

        function exportSelectedSessions() {
            if (selectedSessions.size === 0) return;
            
            try {
                const sessions = JSON.parse(localStorage.getItem('transcription_sessions') || '[]');
                const selectedSessionsData = Array.from(selectedSessions).map(index => sessions[index]).filter(Boolean);
                
                const content = selectedSessionsData.map(session => {
                    const date = new Date(session.startTime);
                    const duration = Math.round((session.duration || 0) / 1000 / 60);
                    const wordCount = session.transcript ? session.transcript.reduce((count, t) => count + t.text.split(' ').length, 0) : 0;
                    const speakers = session.speakers ? session.speakers.length : 0;
                    const transcript = session.transcript ? session.transcript.map(t => `${t.speaker}: ${t.text}`).join('\n\n') : 'No transcript available';
                    
                    return `Meeting Transcription - ${date.toLocaleDateString()} ${date.toLocaleTimeString()}

Duration: ${duration} minutes
Speakers: ${speakers}
Words: ${wordCount}
Audio Source: ${session.audioSourceLabel || 'Microphone'}

${session.summary ? `SUMMARY:\n${session.summary}\n\n` : ''}TRANSCRIPT:\n${transcript}

${'='.repeat(80)}

`;
                }).join('');
                
                const filename = `meeting-sessions-export-${new Date().toISOString().split('T')[0]}.txt`;
                downloadTextFile(content, filename);
                showNotification(`${selectedSessions.size} sessions exported successfully`, 'success');
            } catch (error) {
                console.error('Error exporting sessions:', error);
                showNotification('Error exporting sessions', 'error');
            }
        }

        function exportAllSessions() {
            if (allSessions.length === 0) {
                showNotification('No sessions to export', 'warning');
                return;
            }
            
            try {
                const content = allSessions.map(session => {
                    const date = new Date(session.startTime);
                    const duration = Math.round((session.duration || 0) / 1000 / 60);
                    const wordCount = session.transcript ? session.transcript.reduce((count, t) => count + t.text.split(' ').length, 0) : 0;
                    const speakers = session.speakers ? session.speakers.length : 0;
                    const transcript = session.transcript ? session.transcript.map(t => `${t.speaker}: ${t.text}`).join('\n\n') : 'No transcript available';
                    
                    return `Meeting Transcription - ${date.toLocaleDateString()} ${date.toLocaleTimeString()}

Duration: ${duration} minutes
Speakers: ${speakers}
Words: ${wordCount}
Audio Source: ${session.audioSourceLabel || 'Microphone'}

${session.summary ? `SUMMARY:\n${session.summary}\n\n` : ''}TRANSCRIPT:\n${transcript}

${'='.repeat(80)}

`;
                }).join('');
                
                const filename = `all-meeting-sessions-${new Date().toISOString().split('T')[0]}.txt`;
                downloadTextFile(content, filename);
                showNotification(`All ${allSessions.length} sessions exported successfully`, 'success');
            } catch (error) {
                console.error('Error exporting all sessions:', error);
                showNotification('Error exporting all sessions', 'error');
            }
        }

        function showNotification(message, type = 'info') {
            // Simple notification system
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                transition: all 0.3s ease;
                backdrop-filter: blur(20px);
            `;
            
            switch (type) {
                case 'success':
                    notification.style.background = 'rgba(52, 199, 89, 0.9)';
                    break;
                case 'error':
                    notification.style.background = 'rgba(255, 59, 48, 0.9)';
                    break;
                case 'warning':
                    notification.style.background = 'rgba(255, 149, 0, 0.9)';
                    break;
                default:
                    notification.style.background = 'rgba(0, 122, 255, 0.9)';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        function showSessionModal(event, sessionIndex) {
            event.stopPropagation();
            
            try {
                const sessions = JSON.parse(localStorage.getItem('transcription_sessions') || '[]');
                const session = sessions[sessionIndex];
                
                if (!session) {
                    showNotification('Session not found', 'error');
                    return;
                }
                
                const date = new Date(session.startTime);
                const duration = Math.round((session.duration || 0) / 1000 / 60);
                
                // Get transcript text
                let transcriptText = 'No transcript available';
                if (session.transcript && session.transcript.length > 0) {
                    transcriptText = session.transcript
                        .filter(t => t.text && t.text.trim())
                        .map(t => `${t.speaker || 'Speaker'}: ${t.text}`)
                        .join('\n\n');
                    
                    if (!transcriptText.trim()) {
                        transcriptText = 'No transcript available';
                    }
                }
                
                // Get summary
                const summary = session.summary && session.summary !== 'No summary available' 
                    ? session.summary 
                    : 'No summary available';
                
                const modalHtml = `
                    <div class="session-modal" onclick="closeSessionModal(event)">
                        <div class="session-modal-content" onclick="event.stopPropagation()">
                            <div class="session-modal-header">
                                <div>
                                    <h3>${session.title || `Meeting ${date.toLocaleDateString()}`}</h3>
                                    <div class="session-date">
                                        ${date.toLocaleDateString()} ${date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })} • ${duration} min
                                    </div>
                                </div>
                                <button class="modal-close-btn" onclick="closeSessionModal()">×</button>
                            </div>
                            <div class="session-modal-body">
                                <div class="session-section">
                                    <h4>Summary</h4>
                                    <div class="session-summary">${summary}</div>
                                </div>
                                
                                <div class="session-section">
                                    <h4>Transcript</h4>
                                    <div class="session-transcript">${transcriptText}</div>
                                </div>
                            </div>
                            <div class="session-modal-footer">
                                <button class="session-action-button danger" onclick="deleteSession(event, ${sessionIndex}); closeSessionModal();">Delete Session</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', modalHtml);
                
            } catch (error) {
                showNotification('Error opening session details', 'error');
            }
        }

        function closeSessionModal(event) {
            // Close if clicking the backdrop or close button
            if (!event || event.target.classList.contains('session-modal') || event.target.classList.contains('modal-close-btn')) {
                const modal = document.querySelector('.session-modal');
                if (modal) {
                    modal.remove();
                }
            }
        }

        function exportSession(sessionId) {
            try {
                const sessions = JSON.parse(localStorage.getItem('transcription_sessions') || '[]');
                const session = sessions.find(s => s.id === sessionId);
                
                if (!session) return;
                
                const date = new Date(session.startTime);
                const transcript = session.transcript ? session.transcript.map(t => `${t.speaker}: ${t.text}`).join('\n\n') : 'No transcript available';
                
                const exportContent = `REMBRA MEETING TRANSCRIPT

=====================================

Session: ${session.title || `Meeting ${date.toLocaleDateString()}`}
Date: ${date.toLocaleDateString()} at ${date.toLocaleTimeString()}
Duration: ${Math.round(session.duration / 1000 / 60)} minutes
Audio Source: ${session.audioSourceLabel || 'Microphone'}
Speakers: ${session.speakers ? session.speakers.join(', ') : 'Unknown'}

SUMMARY:
${session.summary || 'No summary available'}

FULL TRANSCRIPT:
${transcript}

=====================================
Generated by Rembra on ${new Date().toLocaleString()}`;

                // Create download
                const blob = new Blob([exportContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `rembra-session-${date.toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                console.log('Session exported successfully');
                
            } catch (error) {
                console.error('Error exporting session:', error);
            }
        }

        function copySessionToClipboard(sessionIndex) {
            try {
                const sessions = JSON.parse(localStorage.getItem('transcription_sessions') || '[]');
                const session = sessions[sessionIndex];
                
                if (!session) {
                    showNotification('Session not found', 'error');
                    return;
                }
                
                const date = new Date(session.startTime);
                const duration = Math.round((session.duration || 0) / 1000 / 60);
                const wordCount = session.transcript ? session.transcript.reduce((count, t) => count + t.text.split(' ').length, 0) : 0;
                const speakers = session.speakers ? session.speakers.length : 0;
                const transcript = session.transcript ? session.transcript.map(t => `${t.speaker}: ${t.text}`).join('\n\n') : 'No transcript available';
                
                const content = `REMBRA MEETING TRANSCRIPT

Session: ${session.title || `Meeting ${date.toLocaleDateString()}`}
Date: ${date.toLocaleDateString()} at ${date.toLocaleTimeString()}
Duration: ${duration} minutes
Speakers: ${speakers}
Words: ${wordCount}
Audio Source: ${session.audioSourceLabel || 'Microphone'}

SUMMARY:
${session.summary || 'No summary available'}

FULL TRANSCRIPT:
${transcript}`;

                navigator.clipboard.writeText(content).then(() => {
                    showNotification('Session copied to clipboard', 'success');
                }).catch(() => {
                    showNotification('Failed to copy to clipboard', 'error');
                });
                
            } catch (error) {
                console.error('❌ Error copying to clipboard:', error);
                showNotification('Error copying session', 'error');
            }
        }

        // Client management
        let clients = [];

        async function loadClients() {
            const container = document.getElementById('clientsList');
            
            try {
                // Try to get clients from IPC first
                try {
                    clients = await ipcRenderer.invoke('get-clients') || [];
                    console.log('Loaded clients from IPC:', clients);
                    // Debug: Log the first client's brief history structure
                    if (clients.length > 0 && clients[0].briefHistory) {
                        console.log('First client brief history sample:', clients[0].briefHistory[0]);
                    }
                } catch (ipcError) {
                    console.log('IPC get-clients not available, using localStorage fallback');
                    // Fallback to localStorage
                    clients = JSON.parse(localStorage.getItem('rembra_clients') || '[]');
                    console.log('Loaded clients from localStorage:', clients);
                }
                
                renderClients();
                
            } catch (error) {
                console.error('Error loading clients:', error);
                container.innerHTML = `
                    <div class="clients-empty">
                        <h4>Error Loading Clients</h4>
                        <p>Failed to load client data. Please try again.</p>
                        <button class="btn btn-secondary" onclick="loadClients()">Retry</button>
                    </div>
                `;
            }
        }

        function renderClients() {
            const container = document.getElementById('clientsList');
            
            if (clients.length === 0) {
                container.innerHTML = `
                    <div class="clients-empty">
                        <h4>No clients added</h4>
                        <p>Add clients to generate personalized meeting briefs and organize your contacts</p>
                        <button class="btn" onclick="showAddClientModal()">Add Your First Client</button>
                    </div>
                `;
                return;
            }

            container.innerHTML = clients.map((client, index) => {
                const initials = getClientInitials(client.name);
                const company = client.company ? ` at ${client.company}` : '';
                
                // Calculate brief count from briefHistory
                const briefCount = client.briefHistory ? client.briefHistory.length : 0;
                
                // Get last meeting/brief date
                let lastMeeting = 'Never';
                if (client.briefHistory && client.briefHistory.length > 0) {
                    // Get the most recent brief
                    const sortedBriefs = client.briefHistory.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    lastMeeting = new Date(sortedBriefs[0].createdAt).toLocaleDateString();
                }
                
                return `
                    <div class="client-card" onclick="selectClient(event, '${client.id}')">
                        <div class="client-header">
                            <div class="client-info">
                                <div class="client-avatar">${initials}</div>
                                <h4 class="client-name">${client.name}</h4>
                                ${client.company ? `<p class="client-company">${client.company}</p>` : ''}
                                ${client.email ? `<p class="client-email">${client.email}</p>` : ''}
                            </div>
                        </div>
                        
                        <div class="client-stats">
                            <div class="client-stat">
                                <div class="client-stat-value">${briefCount}</div>
                                <div class="client-stat-label">Briefs</div>
                            </div>
                            <div class="client-stat">
                                <div class="client-stat-value">${lastMeeting}</div>
                                <div class="client-stat-label">Last Brief</div>
                            </div>
                        </div>
                        
                        <div class="client-actions">
                            <div class="client-action-btn edit" onclick="editClient(event, '${client.id}')" title="Edit Client">
                                ✏️
                            </div>
                            <div class="client-action-btn delete" onclick="deleteClient(event, '${client.id}')" title="Delete Client">
                                🗑️
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getClientInitials(name) {
            if (!name) return '?';
            const words = name.trim().split(' ');
            if (words.length === 1) {
                return words[0].substring(0, 2).toUpperCase();
            }
            return (words[0][0] + words[words.length - 1][0]).toUpperCase();
        }

        function selectClient(event, clientId) {
            // Prevent selection if clicking on action buttons
            if (event.target.closest('.client-actions')) {
                return;
            }
            
            const client = clients.find(c => c.id === clientId);
            if (!client) return;
            
            showClientDetailsModal(client);
        }

        function showClientDetailsModal(client) {
            const briefHistory = client.briefHistory || [];
            const briefsHtml = briefHistory.length > 0 
                ? briefHistory
                    .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                    .map((brief, index) => `
                        <div class="brief-item" onclick="showBriefContent(${index})">
                            <div class="brief-header">
                                <h5>${brief.title || 'Untitled Brief'}</h5>
                                <span class="brief-date">${new Date(brief.createdAt).toLocaleDateString()}</span>
                            </div>
                            <p class="brief-objective">${brief.objective || 'No objective specified'}</p>
                            ${brief.topic ? `<span class="brief-topic">${brief.topic}</span>` : ''}
                            ${brief.isFollowUp ? `<span class="brief-followup">Follow-up</span>` : ''}
                        </div>
                    `).join('')
                : '<p style="color: #94a3b8; text-align: center; padding: 20px;">No briefs generated yet</p>';

            // Store the brief history globally so we can access it in showBriefContent
            window.currentClientBriefs = briefHistory.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            const modalHtml = `
                <div class="session-modal" onclick="closeClientDetailsModal(event)">
                    <div class="session-modal-content" style="max-width: 700px;" onclick="event.stopPropagation()">
                        <div class="session-modal-header">
                            <div>
                                <h3>${client.name}</h3>
                                ${client.company ? `<p class="session-date">${client.company}</p>` : ''}
                            </div>
                            <button class="modal-close-btn" onclick="closeClientDetailsModal(event)">×</button>
                        </div>
                        <div class="session-modal-body">
                            <div class="session-section">
                                <h4>Client Information</h4>
                                <div style="background: rgba(255, 255, 255, 0.04); border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                                    ${client.email ? `<p><strong>Email:</strong> ${client.email}</p>` : ''}
                                    ${client.phone ? `<p><strong>Phone:</strong> ${client.phone}</p>` : ''}
                                    ${client.industry ? `<p><strong>Industry:</strong> ${client.industry}</p>` : ''}
                                    ${client.notes ? `<p><strong>Notes:</strong> ${client.notes}</p>` : ''}
                                    <p><strong>Created:</strong> ${new Date(client.createdAt).toLocaleDateString()}</p>
                                </div>
                            </div>
                            <div class="session-section">
                                <h4>Brief History (${briefHistory.length}) - Click to view content</h4>
                                <div class="briefs-container">
                                    ${briefsHtml}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function closeClientDetailsModal(event) {
            if (!event || event.target.classList.contains('session-modal') || event.target.classList.contains('modal-close-btn') || event.target.textContent === '×') {
                const modal = document.querySelector('.session-modal');
                if (modal) {
                    modal.style.opacity = '0';
                    modal.style.transform = 'scale(0.9)';
                    setTimeout(() => {
                        if (modal.parentNode) {
                            document.body.removeChild(modal);
                        }
                    }, 300);
                }
            }
        }

        function convertMarkdownToHTML(text) {
            if (!text) return '';
            
            let html = text;
            
            // Convert headers (### -> h3, ## -> h2, # -> h1)
            html = html.replace(/^### (.*$)/gm, '<h3 style="color: #f0f0f0; margin: 20px 0 10px 0; font-size: 18px; font-weight: 600;">$1</h3>');
            html = html.replace(/^## (.*$)/gm, '<h2 style="color: #f0f0f0; margin: 24px 0 12px 0; font-size: 20px; font-weight: 600;">$1</h2>');
            html = html.replace(/^# (.*$)/gm, '<h1 style="color: #f0f0f0; margin: 28px 0 14px 0; font-size: 24px; font-weight: 600;">$1</h1>');
            
            // Convert bold text
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong style="color: #ffffff; font-weight: 600;">$1</strong>');
            
            // Convert bullet points
            html = html.replace(/^\* (.*$)/gm, '<li style="margin: 6px 0; color: #e0e0e0;">$1</li>');
            
            // Wrap consecutive list items in ul tags
            html = html.replace(/(<li.*?<\/li>\s*)+/g, function(match) {
                return '<ul style="margin: 12px 0; padding-left: 20px; list-style-type: disc;">' + match + '</ul>';
            });
            
            // Convert line breaks to paragraphs
            html = html.split('\n\n').map(paragraph => {
                if (paragraph.trim() && !paragraph.includes('<h') && !paragraph.includes('<ul') && !paragraph.includes('<li')) {
                    return '<p style="margin: 12px 0; color: #e0e0e0; line-height: 1.6;">' + paragraph.trim() + '</p>';
                }
                return paragraph;
            }).join('\n');
            
            // Convert remaining single line breaks to <br>
            html = html.replace(/\n/g, '<br>');
            
            return html;
        }

        function showBriefContent(briefIndex) {
            // Get the brief from the stored array
            if (!window.currentClientBriefs || !window.currentClientBriefs[briefIndex]) {
                console.error('Brief not found at index:', briefIndex);
                return;
            }

            const brief = window.currentClientBriefs[briefIndex];
            console.log('📋 Showing brief content:', brief);

            // Close current modal first
            closeClientDetailsModal({ target: { classList: { contains: () => true } } });
            
            // Show brief content in a new modal
            const content = brief.content || brief.generatedContent || 'No content available for this brief.';
            const title = brief.title || 'Untitled Brief';
            
            const modalHtml = `
                <div class="session-modal" onclick="closeBriefModal(event)">
                    <div class="session-modal-content" style="max-width: 800px;" onclick="event.stopPropagation()">
                        <div class="session-modal-header">
                            <div>
                                <h3>${title}</h3>
                                <p class="session-date">Brief Content - ${new Date(brief.createdAt).toLocaleDateString()}</p>
                            </div>
                            <button class="modal-close-btn" onclick="closeBriefModal(event)">×</button>
                        </div>
                        <div class="session-modal-body">
                            <div class="session-section">
                                ${brief.objective ? `
                                    <h4>Objective</h4>
                                    <div style="background: rgba(255, 255, 255, 0.04); border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                                        <p>${brief.objective}</p>
                                    </div>
                                ` : ''}
                                <h4>Brief Content</h4>
                                <div class="session-summary">
                                    ${convertMarkdownToHTML(content)}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function closeBriefModal(event) {
            if (!event || event.target.classList.contains('session-modal') || event.target.classList.contains('modal-close-btn') || event.target.textContent === '×') {
                const modal = document.querySelector('.session-modal');
                if (modal) {
                    modal.style.opacity = '0';
                    modal.style.transform = 'scale(0.9)';
                    setTimeout(() => {
                        if (modal.parentNode) {
                            document.body.removeChild(modal);
                        }
                    }, 300);
                }
            }
        }

        function showAddClientModal() {
            document.getElementById('addClientModal').style.display = 'flex';
            document.getElementById('addClientForm').reset();
        }

        function editClient(event, clientId) {
            event.stopPropagation();
            
            const client = clients.find(c => c.id === clientId);
            if (!client) return;
            
            // Populate edit form
            document.getElementById('editClientId').value = client.id;
            document.getElementById('editClientName').value = client.name || '';
            document.getElementById('editClientCompany').value = client.company || '';
            document.getElementById('editClientEmail').value = client.email || '';
            document.getElementById('editClientPhone').value = client.phone || '';
            document.getElementById('editClientNotes').value = client.notes || '';
            
            document.getElementById('editClientModal').style.display = 'flex';
        }

        async function deleteClient(event, clientId) {
            event.stopPropagation();
            
            const client = clients.find(c => c.id === clientId);
            if (!client) return;
            
            if (!confirm(`Are you sure you want to delete ${client.name}? This action cannot be undone.`)) {
                return;
            }
            
            try {
                // Try IPC first
                try {
                    const result = await ipcRenderer.invoke('delete-client', clientId);
                    if (result.success) {
                        console.log('Client deleted via IPC');
                    } else {
                        throw new Error(result.error || 'Failed to delete client');
                    }
                } catch (ipcError) {
                    console.log('IPC delete-client not available, using localStorage fallback');
                    // Fallback to localStorage
                    clients = clients.filter(c => c.id !== clientId);
                    localStorage.setItem('rembra_clients', JSON.stringify(clients));
                }
                
                loadClients();
                showNotification('Client deleted successfully', 'success');
                
            } catch (error) {
                console.error('Error deleting client:', error);
                showNotification('Error deleting client', 'error');
            }
        }

        async function addClient() {
            const form = document.getElementById('addClientForm');
            
            const clientData = {
                name: document.getElementById('clientName').value.trim(),
                company: document.getElementById('clientCompany').value.trim(),
                email: document.getElementById('clientEmail').value.trim(),
                phone: document.getElementById('clientPhone').value.trim(),
                notes: document.getElementById('clientNotes').value.trim(),
                industry: '', // Could add industry field later
                topics: ['General'] // Default topic
            };
            
            if (!clientData.name) {
                showNotification('Client name is required', 'error');
                return;
            }
            
            try {
                // Try IPC first
                try {
                    const result = await ipcRenderer.invoke('add-client', clientData);
                    if (result && result.id) {
                        console.log('Client added via IPC:', result);
                    } else {
                        throw new Error('Failed to add client via IPC');
                    }
                } catch (ipcError) {
                    console.log('IPC add-client not available, using localStorage fallback');
                    // Fallback to localStorage with same structure as ClientManager
                    const newClient = {
                        id: Date.now().toString(),
                        name: clientData.name,
                        company: clientData.company,
                        industry: clientData.industry || '',
                        email: clientData.email || '',
                        phone: clientData.phone || '',
                        notes: clientData.notes || '',
                        topics: clientData.topics || ['General'],
                        briefHistory: [],
                        createdAt: new Date()
                    };
                    clients.push(newClient);
                    localStorage.setItem('rembra_clients', JSON.stringify(clients));
                }
                
                closeModal('addClientModal');
                loadClients();
                showNotification('Client added successfully', 'success');
                
            } catch (error) {
                console.error('❌ Error adding client:', error);
                showNotification('Error adding client', 'error');
            }
        }

        async function updateClient() {
            const clientId = document.getElementById('editClientId').value;
            const clientData = {
                name: document.getElementById('editClientName').value.trim(),
                company: document.getElementById('editClientCompany').value.trim(),
                email: document.getElementById('editClientEmail').value.trim(),
                phone: document.getElementById('editClientPhone').value.trim(),
                notes: document.getElementById('editClientNotes').value.trim()
            };
            
            if (!clientData.name) {
                showNotification('Client name is required', 'error');
                return;
            }
            
            try {
                // Try IPC first (note: ClientManager expects clientId and updates as separate params)
                try {
                    const result = await ipcRenderer.invoke('update-client', clientId, clientData);
                    if (result && result.id) {
                        console.log('Client updated via IPC:', result);
                    } else {
                        throw new Error('Failed to update client via IPC');
                    }
                } catch (ipcError) {
                    console.log('IPC update-client not available, using localStorage fallback');
                    // Fallback to localStorage
                    const clientIndex = clients.findIndex(c => c.id === clientId);
                    if (clientIndex !== -1) {
                        clients[clientIndex] = { ...clients[clientIndex], ...clientData };
                        localStorage.setItem('rembra_clients', JSON.stringify(clients));
                    }
                }
                
                closeModal('editClientModal');
                loadClients();
                showNotification('Client updated successfully', 'success');
                
            } catch (error) {
                console.error('❌ Error updating client:', error);
                showNotification('Error updating client', 'error');
            }
        }

        async function loadPrivacySettings() {
            try {
                const result = await ipcRenderer.invoke('get-content-protection');
                const toggle = document.getElementById('contentProtectionToggle');
                if (toggle) {
                    toggle.classList.toggle('active', result.enabled);
                }
            } catch (error) {
                console.error('Failed to load privacy settings:', error);
            }
        }

        function getUserDisplayName(email) {
            if (email) {
                const name = email.split('@')[0];
                return name.charAt(0).toUpperCase() + name.slice(1);
            }
            return 'User';
        }

        function getUserInitials(email) {
            const displayName = getUserDisplayName(email);
            return displayName.substring(0, 2).toUpperCase();
        }

        function showChangeEmailModal() {
            document.getElementById('changeEmailModal').style.display = 'flex';
        }

        function showChangePasswordModal() {
            document.getElementById('changePasswordModal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            // Reset forms
            const form = document.querySelector(`#${modalId} form`);
            if (form) form.reset();
        }

        async function sendPasswordReset() {
            if (!currentUser) {
                alert('User information not available');
                return;
            }

            try {
                const result = await ipcRenderer.invoke('send-password-reset', currentUser.email);
                if (result.success) {
                    alert('Password reset email sent successfully!');
                } else {
                    alert('Failed to send password reset email: ' + result.error);
                }
            } catch (error) {
                console.error('Error sending password reset:', error);
                alert('Failed to send password reset email');
            }
        }

        function confirmDeleteAccount() {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone and will permanently delete all your data.')) {
                // Could open a more detailed confirmation modal here
                alert('Account deletion feature will be implemented in a future update.');
            }
        }

        async function signOut() {
            console.log('🔍 Sign out clicked');
            try {
                console.log('🔍 Calling logout IPC...');
                const result = await ipcRenderer.invoke('logout');
                console.log('🔍 Logout result:', result);
                closeSettings();
            } catch (error) {
                console.error('❌ Error signing out:', error);
                alert('Failed to sign out: ' + error.message);
            }
        }

        function closeSettings() {
            ipcRenderer.send('close-settings');
        }

        // Utility functions for about section
        function checkForUpdates() {
            alert('You are using the latest version!');
        }

        function openDocumentation() {
            ipcRenderer.invoke('open-external', 'https://docs.rembra.com');
        }

        function contactSupport() {
            ipcRenderer.invoke('open-external', 'mailto:support@rembra.com');
        }

        function sendFeedback() {
            ipcRenderer.invoke('open-external', 'https://rembra.com/feedback');
        }

        function openPrivacyPolicy() {
            ipcRenderer.invoke('open-external', 'https://rembra.com/privacy');
        }

        function openTermsOfService() {
            ipcRenderer.invoke('open-external', 'https://rembra.com/terms');
        }

        async function openDataFolder() {
            try {
                await ipcRenderer.invoke('open-data-folder');
            } catch (error) {
                console.error('Error opening data folder:', error);
            }
        }

        async function clearAllData() {
            if (confirm('This will permanently delete all your local recordings and settings. Are you sure?')) {
                try {
                    await ipcRenderer.invoke('clear-all-data');
                    alert('All data cleared successfully');
                } catch (error) {
                    console.error('Error clearing data:', error);
                    alert('Failed to clear data');
                }
            }
        }

        // Usage & Billing Functions
        async function loadUsageData() {
            console.log('Loading usage data...');
            try {
                // Load beta usage data from BetaUsageManager
                let currentUsage = {};
                try {
                    const BetaUsageManager = require('../services/BetaUsageManager');
                    currentUsage = BetaUsageManager.getCurrentUsage();
                } catch (error) {
                    console.error('Failed to load BetaUsageManager:', error);
                    currentUsage = {
                        transcription: 0,
                        briefs: 0,
                        emails: 0,
                        ai_assists: 0
                    };
                }

                // Beta limits
                const limits = {
                    transcription: 120, // minutes
                    briefs: 15,
                    emails: 20,
                    ai_assists: 30
                };
                
                // Update usage display in the usageCards div
                const usageCards = document.getElementById('usageCards');
                if (usageCards) {
                    usageCards.innerHTML = `
                        <div class="usage-card">
                            <div class="usage-header">
                                <span class="usage-title"><i class="fas fa-microphone" style="color: #10b981;"></i> Transcription</span>
                            </div>
                            <div class="usage-stats">${currentUsage.transcription || 0} / ${limits.transcription} minutes</div>
                            <div class="usage-progress">
                                <div class="usage-progress-bar ${(currentUsage.transcription/limits.transcription)*100 > 80 ? ((currentUsage.transcription/limits.transcription)*100 > 95 ? 'danger' : 'warning') : ''}" style="width: ${Math.min((currentUsage.transcription/limits.transcription)*100, 100)}%"></div>
                            </div>
                            <div class="usage-percentage">${Math.round((currentUsage.transcription/limits.transcription)*100)}% used this month</div>
                        </div>

                        <div class="usage-card">
                            <div class="usage-header">
                                <span class="usage-title"><i class="fas fa-file-alt" style="color: #3b82f6;"></i> Brief Generation</span>
                            </div>
                            <div class="usage-stats">${currentUsage.briefs || 0} / ${limits.briefs} briefs</div>
                            <div class="usage-progress">
                                <div class="usage-progress-bar ${(currentUsage.briefs/limits.briefs)*100 > 80 ? ((currentUsage.briefs/limits.briefs)*100 > 95 ? 'danger' : 'warning') : ''}" style="width: ${Math.min((currentUsage.briefs/limits.briefs)*100, 100)}%"></div>
                            </div>
                            <div class="usage-percentage">${Math.round((currentUsage.briefs/limits.briefs)*100)}% used this month</div>
                        </div>

                        <div class="usage-card">
                            <div class="usage-header">
                                <span class="usage-title"><i class="fas fa-envelope" style="color: #f59e0b;"></i> Email Generation</span>
                            </div>
                            <div class="usage-stats">${currentUsage.emails || 0} / ${limits.emails} emails</div>
                            <div class="usage-progress">
                                <div class="usage-progress-bar ${(currentUsage.emails/limits.emails)*100 > 80 ? ((currentUsage.emails/limits.emails)*100 > 95 ? 'danger' : 'warning') : ''}" style="width: ${Math.min((currentUsage.emails/limits.emails)*100, 100)}%"></div>
                            </div>
                            <div class="usage-percentage">${Math.round((currentUsage.emails/limits.emails)*100)}% used this month</div>
                        </div>

                        <div class="usage-card">
                            <div class="usage-header">
                                <span class="usage-title"><i class="fas fa-brain" style="color: #8b5cf6;"></i> AI Assists</span>
                            </div>
                            <div class="usage-stats">${currentUsage.ai_assists || 0} / ${limits.ai_assists} assists</div>
                            <div class="usage-progress">
                                <div class="usage-progress-bar ${(currentUsage.ai_assists/limits.ai_assists)*100 > 80 ? ((currentUsage.ai_assists/limits.ai_assists)*100 > 95 ? 'danger' : 'warning') : ''}" style="width: ${Math.min((currentUsage.ai_assists/limits.ai_assists)*100, 100)}%"></div>
                            </div>
                            <div class="usage-percentage">${Math.round((currentUsage.ai_assists/limits.ai_assists)*100)}% used this month</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Failed to load usage data:', error);
            }
        }

        function viewSession(sessionId) {
            const sessions = JSON.parse(localStorage.getItem('transcription_sessions') || '[]');
            const session = sessions.find(s => s.id.toString() === sessionId.toString());
            
            if (!session) {
                console.error('Session not found:', sessionId);
                return;
            }

            const sessionDate = new Date(session.date || session.startTime);
            const duration = session.duration ? Math.round(session.duration / 1000 / 60) : 0;
            const speakers = session.speakers ? session.speakers.length : 0;

            const modalHtml = `
                <div class="session-modal" onclick="closeSessionModal(event)">
                    <div class="session-modal-content" onclick="event.stopPropagation()">
                        <div class="session-modal-header">
                            <div>
                                <h3>${session.title || 'Recording Session'}</h3>
                                <p class="session-date">${sessionDate.toLocaleDateString()} ${sessionDate.toLocaleTimeString()}</p>
                            </div>
                            <button class="modal-close-btn" onclick="closeSessionModal(event)">×</button>
                        </div>
                        <div class="session-modal-body">
                            <div class="session-section">
                                <h4>Session Details</h4>
                                <div style="background: rgba(255, 255, 255, 0.04); border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                                    <p><strong>Duration:</strong> ${duration} minutes</p>
                                    <p><strong>Speakers:</strong> ${speakers}</p>
                                    <p><strong>Word Count:</strong> ${session.wordCount || 0}</p>
                                    <p><strong>Date:</strong> ${sessionDate.toLocaleDateString()} ${sessionDate.toLocaleTimeString()}</p>
                                </div>
                            </div>
                            ${session.aiSummary ? `
                                <div class="session-section">
                                    <h4>🤖 AI Summary</h4>
                                    <div class="session-summary">
                                        ${convertMarkdownToHTML(session.aiSummary)}
                                    </div>
                                </div>
                            ` : ''}
                            <div class="session-section">
                                <h4>📝 Full Transcript</h4>
                                <div class="session-transcript">
                                    ${session.summary || 'No transcript available'}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function closeSessionModal(event) {
            if (!event || event.target.classList.contains('session-modal') || event.target.classList.contains('modal-close-btn') || event.target.textContent === '×') {
                const modal = document.querySelector('.session-modal');
                if (modal) {
                    modal.style.opacity = '0';
                    modal.style.transform = 'scale(0.9)';
                    setTimeout(() => {
                        if (modal.parentNode) {
                            document.body.removeChild(modal);
                        }
                    }, 300);
                }
            }
        }

        function exportSession(sessionId) {
            const sessions = JSON.parse(localStorage.getItem('transcription_sessions') || '[]');
            const session = sessions.find(s => s.id.toString() === sessionId.toString());
            
            if (!session) {
                console.error('Session not found for export:', sessionId);
                return;
            }

            const sessionDate = new Date(session.date || session.startTime);
            const duration = session.duration ? Math.round(session.duration / 1000 / 60) : 0;
            
            let exportContent = `Recording Session Export\n`;
            exportContent += `========================\n\n`;
            exportContent += `Title: ${session.title || 'Recording Session'}\n`;
            exportContent += `Date: ${sessionDate.toLocaleDateString()} ${sessionDate.toLocaleTimeString()}\n`;
            exportContent += `Duration: ${duration} minutes\n`;
            exportContent += `Speakers: ${session.speakers ? session.speakers.length : 0}\n`;
            exportContent += `Word Count: ${session.wordCount || 0}\n\n`;
            
            if (session.aiSummary) {
                exportContent += `AI Summary:\n`;
                exportContent += `-----------\n`;
                exportContent += `${session.aiSummary}\n\n`;
            }
            
            exportContent += `Full Transcript:\n`;
            exportContent += `---------------\n`;
            exportContent += `${session.summary || 'No transcript available'}\n`;

            // Create and download file
            const blob = new Blob([exportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rembra-session-${sessionDate.toISOString().split('T')[0]}-${sessionId}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            console.log('📁 Session exported:', sessionId);
        }

        function deleteSession(sessionId) {
            if (!confirm('Are you sure you want to delete this session? This action cannot be undone.')) {
                return;
            }

            try {
                // Remove from transcription_sessions
                let sessions = JSON.parse(localStorage.getItem('transcription_sessions') || '[]');
                sessions = sessions.filter(s => s.id.toString() !== sessionId.toString());
                localStorage.setItem('transcription_sessions', JSON.stringify(sessions));
                
                // Also remove from client_sessions for consistency
                let clientSessions = JSON.parse(localStorage.getItem('client_sessions') || '[]');
                clientSessions = clientSessions.filter(s => s.id.toString() !== sessionId.toString());
                localStorage.setItem('client_sessions', JSON.stringify(clientSessions));
                
                // Reload sessions display
                loadSessions();
                
                console.log('Session deleted:', sessionId);
            } catch (error) {
                console.error('❌ Failed to delete session:', error);
                alert('Failed to delete session: ' + error.message);
            }
        }

        function exportAllSessions() {
            const sessions = JSON.parse(localStorage.getItem('transcription_sessions') || '[]');
            
            if (sessions.length === 0) {
                alert('No sessions to export');
                return;
            }

            let exportContent = `Rembra Sessions Export\n`;
            exportContent += `=====================\n`;
            exportContent += `Export Date: ${new Date().toLocaleDateString()}\n`;
            exportContent += `Total Sessions: ${sessions.length}\n\n`;
            
            sessions.forEach((session, index) => {
                const sessionDate = new Date(session.date || session.startTime);
                const duration = session.duration ? Math.round(session.duration / 1000 / 60) : 0;
                
                exportContent += `Session ${index + 1}: ${session.title || 'Recording Session'}\n`;
                exportContent += `${'='.repeat(50)}\n`;
                exportContent += `Date: ${sessionDate.toLocaleDateString()} ${sessionDate.toLocaleTimeString()}\n`;
                exportContent += `Duration: ${duration} minutes\n`;
                exportContent += `Speakers: ${session.speakers ? session.speakers.length : 0}\n`;
                exportContent += `Word Count: ${session.wordCount || 0}\n\n`;
                
                if (session.aiSummary) {
                    exportContent += `AI Summary:\n${session.aiSummary}\n\n`;
                }
                
                exportContent += `Transcript:\n${session.summary || 'No transcript available'}\n\n\n`;
            });

            // Create and download file
            const blob = new Blob([exportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rembra-all-sessions-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            console.log('📁 All sessions exported');
        }

        function clearAllSessions() {
            if (!confirm('Are you sure you want to delete ALL sessions? This action cannot be undone and will permanently delete all transcripts and AI summaries.')) {
                return;
            }

            try {
                localStorage.removeItem('transcription_sessions');
                localStorage.removeItem('client_sessions');
                loadSessions();
                console.log('All sessions cleared');
            } catch (error) {
                console.error('❌ Failed to clear sessions:', error);
                alert('Failed to clear sessions: ' + error.message);
            }
        }

        function showSubscriptionPlans() {
            // Create subscription plans modal
            const modalHtml = `
                <div class="subscription-modal" id="subscriptionModal" onclick="closeSubscriptionModal(event)">
                    <div class="subscription-modal-content" onclick="event.stopPropagation()">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px;">
                            <h3 style="margin: 0; color: #ffffff; font-size: 24px; font-weight: 700;">💎 Subscription Plans</h3>
                            <button class="modal-close-btn" onclick="closeSubscriptionModal(event)">×</button>
                        </div>
                        
                        <div style="background: rgba(255, 149, 0, 0.1); border: 1px solid rgba(255, 149, 0, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                            <h4 style="margin: 0 0 8px 0; color: #FF9500; font-size: 16px; font-weight: 600;">🚀 You're on Beta!</h4>
                            <p style="margin: 0; font-size: 14px; line-height: 1.6; color: #cbd5e1;">You currently have access to all premium features during our beta period. Subscription plans will be available soon with even more advanced features!</p>
                        </div>
                        
                        <div class="plans-grid">
                            <!-- Free Plan -->
                            <div class="plan-card">
                                <div class="plan-name" style="color: #94a3b8;">Free</div>
                                <div class="plan-price">$0<span class="plan-price-period">/month</span></div>
                                <ul class="plan-features">
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> 30 minutes/month</li>
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> Basic transcription</li>
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> Text export</li>
                                    <li class="excluded"><i class="fas fa-times" style="color: #ef4444;"></i> Speaker diarization</li>
                                    <li class="excluded"><i class="fas fa-times" style="color: #ef4444;"></i> AI summaries</li>
                                    <li class="excluded"><i class="fas fa-times" style="color: #ef4444;"></i> Email generation</li>
                                </ul>
                            </div>
                            
                            <!-- Pro Plan -->
                            <div class="plan-card featured">
                                <div class="plan-badge">COMING SOON</div>
                                <div class="plan-name" style="color: #60a5fa;">Pro</div>
                                <div class="plan-price">$19<span class="plan-price-period">/month</span></div>
                                <ul class="plan-features">
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> 10 hours/month</li>
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> Advanced transcription</li>
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> Speaker diarization</li>
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> AI summaries & briefs</li>
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> Email generation</li>
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> Multiple export formats</li>
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> Priority support</li>
                                </ul>
                            </div>
                            
                            <!-- Enterprise Plan -->
                            <div class="plan-card">
                                <div class="plan-name" style="color: #f59e0b;">Enterprise</div>
                                <div class="plan-price">$99<span class="plan-price-period">/month</span></div>
                                <ul class="plan-features">
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> Unlimited usage</li>
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> Priority processing</li>
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> Custom integrations</li>
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> Advanced analytics</li>
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> Team collaboration</li>
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> Dedicated support</li>
                                    <li class="included"><i class="fas fa-check" style="color: #10b981;"></i> Custom AI models</li>
                                </ul>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; justify-content: center; margin-top: 24px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <button onclick="joinWaitlist()" class="btn" style="background: linear-gradient(135deg, #3b82f6, #8b5cf6); border: none; padding: 12px 24px; font-weight: 600;">Join Waitlist</button>
                            <button onclick="closeSubscriptionModal(event)" class="btn btn-secondary">Close</button>
                        </div>
                    </div>
                </div>
            `;

            // Remove existing modal if any
            const existingModal = document.getElementById('subscriptionModal');
            if (existingModal) {
                existingModal.remove();
            }

            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function closeSubscriptionModal(event) {
            if (!event || event.target.classList.contains('subscription-modal') || event.target.classList.contains('modal-close-btn') || event.target.textContent === '×') {
                const modal = document.getElementById('subscriptionModal');
                if (modal) {
                    modal.remove();
                }
            }
        }

        function joinWaitlist() {
            alert('Thanks for your interest! We\'ll notify you when subscription plans are available. In the meantime, enjoy full access during the beta period!');
            closeSubscriptionModal();
        }

        // Form handlers
        document.getElementById('changeEmailForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const newEmail = document.getElementById('newEmail').value;
            const currentPassword = document.getElementById('currentPassword').value;

            try {
                const result = await ipcRenderer.invoke('change-email', { newEmail, currentPassword });
                if (result.success) {
                    alert('Email updated successfully!');
                    closeModal('changeEmailModal');
                    loadUserData();
                } else {
                    alert('Failed to update email: ' + result.error);
                }
            } catch (error) {
                console.error('Error updating email:', error);
                alert('Failed to update email');
            }
        });

        document.getElementById('changePasswordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const currentPassword = document.getElementById('currentPasswordChange').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (newPassword !== confirmPassword) {
                alert('New passwords do not match');
                return;
            }

            try {
                const result = await ipcRenderer.invoke('change-password', { currentPassword, newPassword });
                if (result.success) {
                    alert('Password updated successfully!');
                    closeModal('changePasswordModal');
                } else {
                    alert('Failed to update password: ' + result.error);
                }
            } catch (error) {
                console.error('Error updating password:', error);
                alert('Failed to update password');
            }
        });

        // Client form handlers
        document.getElementById('addClientForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await addClient();
        });

        // Meeting Platform Integration Functions
        async function loadPlatforms() {
            console.log('Loading meeting platforms...');
            const platformsList = document.getElementById('platformsList');
            if (!platformsList) return;

            try {
                // Define platforms with their basic info
                const platformDefinitions = [
                    {
                        key: 'googleMeet',
                        name: 'Google Meet',
                        icon: '<img src="./google.png" style="width: 32px; height: 32px; border-radius: 8px; object-fit: contain;" alt="Google Meet">'
                    },
                    {
                        key: 'teams',
                        name: 'Microsoft Teams',
                        icon: '<img src="./microsoft.webp" style="width: 32px; height: 32px; border-radius: 8px; object-fit: contain;" alt="Microsoft Teams">'
                    },
                    {
                        key: 'zoom',
                        name: 'Zoom',
                        icon: '<img src="./zoom.png" style="width: 32px; height: 32px; border-radius: 8px; object-fit: contain;" alt="Zoom">'
                    },
                    {
                        key: 'webex',
                        name: 'Cisco Webex',
                        icon: '<img src="./webex.png" style="width: 32px; height: 32px; border-radius: 8px; object-fit: contain;" alt="Cisco Webex">'
                    }
                ];

                // Get connection status from stored OAuth tokens via IPC
                const platforms = await Promise.all(platformDefinitions.map(async (platform) => {
                    try {
                        const statusResult = await ipcRenderer.invoke('get-platform-status', platform.key);
                        return {
                            ...platform,
                            connected: statusResult.success ? statusResult.connected : false,
                            enabled: statusResult.success ? statusResult.connected : false
                        };
                    } catch (error) {
                        console.error(`Failed to get status for ${platform.key}:`, error);
                        return {
                            ...platform,
                            connected: false,
                            enabled: false
                        };
                    }
                }));
                
                platformsList.innerHTML = platforms.map(platform => `
                    <div class="usage-card" style="margin-bottom: 16px;">
                        <div class="usage-header" style="justify-content: space-between;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span style="font-size: 24px;">${platform.icon}</span>
                                <div>
                                    <div class="usage-title">${platform.name}</div>
                                    <div style="font-size: 12px; color: rgba(255,255,255,0.6);">
                                        ${platform.connected ? '<i class="fas fa-check-circle" style="color: #10b981;"></i> Connected' : '<i class="fas fa-times-circle" style="color: #ef4444;"></i> Not Connected'}
                                    </div>
                                </div>
                            </div>
                            <button class="btn" onclick="togglePlatform('${platform.key}')" 
                                    style="padding: 6px 12px; font-size: 12px;">
                                ${platform.connected ? 'Disconnect' : 'Connect'}
                            </button>
                        </div>
                        ${platform.connected ? `
                            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1);">
                                <div style="font-size: 12px; color: rgba(255,255,255,0.6);">
                                    <i class="fas fa-check" style="color: #10b981;"></i> Auto-join enabled
                                    <br>
                                    <i class="fas fa-check" style="color: #10b981;"></i> Meeting details sync enabled
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Failed to load platforms:', error);
                platformsList.innerHTML = `
                    <div class="usage-card" style="margin-bottom: 16px;">
                        <div class="usage-header">
                            <div style="color: rgba(255,255,255,0.6);">
                                <i class="fas fa-exclamation-triangle" style="color: #f59e0b;"></i>
                                Meeting platform integration temporarily unavailable.
                                <br><br>
                                <div style="font-size: 12px;">
                                    You can still join meetings manually using the "Quick Meeting Join" section below.
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        async function togglePlatform(platformKey) {
            console.log('Toggling platform:', platformKey);
            
            try {
                // Get current platform status
                const statusResult = await ipcRenderer.invoke('get-platform-status', platformKey);
                const isConnected = statusResult.success ? statusResult.connected : false;
                
                if (isConnected) {
                    // Disconnect platform
                    await disconnectPlatform(platformKey);
                } else {
                    // Connect platform
                    await connectPlatform(platformKey);
                }
                
            } catch (error) {
                console.error('Failed to toggle platform:', error);
                showNotification('Failed to toggle platform connection', 'error');
            }
        }

        async function connectPlatform(platformKey) {
            // Show connection dialog based on platform
            const connectionDialogs = {
                googleMeet: () => showGoogleMeetConnection(),
                teams: () => showTeamsConnection(),
                zoom: () => showZoomConnection(),
                webex: () => showWebexConnection()
            };

            if (connectionDialogs[platformKey]) {
                await connectionDialogs[platformKey]();
            } else {
                showNotification(`Connection for ${platformKey} not yet implemented`, 'warning');
            }
        }

        async function disconnectPlatform(platformKey) {
            const result = confirm('Are you sure you want to disconnect this platform?\n\nYou will need to reconnect to fetch meeting details.');

            if (result) {
                try {
                    // Disconnect via IPC which will clear OAuth tokens
                    const disconnectResult = await ipcRenderer.invoke('disconnect-platform', platformKey);
                    
                    if (disconnectResult.success) {
                        showNotification('Platform disconnected successfully', 'success');
                        loadPlatforms(); // Refresh the list
                    } else {
                        showNotification('Failed to disconnect platform', 'error');
                    }
                } catch (error) {
                    console.error('Failed to disconnect platform:', error);
                    showNotification('Failed to disconnect platform', 'error');
                }
            }
        }

        async function showGoogleMeetConnection() {
            try {
                showNotification('Starting Google OAuth...', 'info');
                
                const result = await ipcRenderer.invoke('connect-google-meet');
                
                if (result.success) {
                    showNotification(result.message, 'success');
                    loadPlatforms(); // Refresh the display
                } else {
                    showNotification(`Google Meet connection failed: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Google Meet connection error:', error);
                showNotification('Google Meet connection failed', 'error');
            }
        }

        async function showTeamsConnection() {
            try {
                showNotification('Starting Microsoft Teams OAuth...', 'info');
                
                const result = await ipcRenderer.invoke('connect-teams');
                
                if (result.success) {
                    showNotification(result.message, 'success');
                    loadPlatforms(); // Refresh the display
                } else {
                    showNotification(`Teams connection failed: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Teams connection error:', error);
                showNotification('Teams connection failed', 'error');
            }
        }

        async function showZoomConnection() {
            try {
                showNotification('Starting Zoom OAuth...', 'info');
                
                const result = await ipcRenderer.invoke('connect-zoom');
                
                if (result.success) {
                    showNotification(result.message, 'success');
                    loadPlatforms(); // Refresh the display
                } else {
                    showNotification(`Zoom connection failed: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Zoom connection error:', error);
                showNotification('Zoom connection failed', 'error');
            }
        }

        async function showWebexConnection() {
            try {
                showNotification('Starting Cisco Webex OAuth...', 'info');
                
                const result = await ipcRenderer.invoke('connect-webex');
                
                if (result.success) {
                    showNotification(result.message, 'success');
                    loadPlatforms(); // Refresh the display
                } else {
                    showNotification(`Webex connection failed: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Webex connection error:', error);
                showNotification('Webex connection failed', 'error');
            }
        }

        async function joinMeetingFromUrl() {
            const urlInput = document.getElementById('meetingUrlInput');
            const meetingUrl = urlInput.value.trim();
            
            if (!meetingUrl) {
                showNotification('Please enter a meeting URL', 'error');
                return;
            }

            try {
                console.log('Joining meeting:', meetingUrl);
                
                // Initialize MeetingPlatformManager if not already loaded
                if (typeof window.MeetingPlatformManager === 'undefined') {
                    try {
                        const MeetingPlatformManagerClass = require('../services/MeetingPlatformManager');
                        window.MeetingPlatformManager = new MeetingPlatformManagerClass();
                    } catch (error) {
                        console.error('Failed to load MeetingPlatformManager:', error);
                    }
                }
                
                // Detect platform
                const platform = window.MeetingPlatformManager ? 
                    window.MeetingPlatformManager.detectPlatform(meetingUrl) : 
                    this.detectBasicPlatform(meetingUrl);
                
                if (!platform) {
                    showNotification('Unsupported meeting platform. Supported: Google Meet, Teams, Zoom', 'error');
                    return;
                }

                // Get meeting details (basic for now)
                const meetingDetails = {
                    platform: platform.charAt(0).toUpperCase() + platform.slice(1),
                    title: `${platform.charAt(0).toUpperCase() + platform.slice(1)} Meeting`,
                    participants: [],
                    startTime: new Date().toISOString(),
                    url: meetingUrl
                };

                // Start meeting session with auto-record enabled
                const sessionResult = await ipcRenderer.invoke('start-meeting-session', {
                    meetingUrl: meetingUrl,
                    platform: meetingDetails.platform,
                    title: meetingDetails.title,
                    participants: meetingDetails.participants,
                    startTime: meetingDetails.startTime,
                    autoRecord: true
                });

                if (sessionResult.success) {
                    // Open meeting URL
                    const { shell } = require('electron');
                    await shell.openExternal(meetingUrl);
                    
                    // Show recording panel
                    await ipcRenderer.invoke('show-listen-panel');
                    
                    showNotification(`${meetingDetails.platform} meeting opened! Auto-recording started.`, 'success');
                    urlInput.value = '';
                } else {
                    showNotification('Failed to start meeting session: ' + sessionResult.error, 'error');
                }
                
            } catch (error) {
                console.error('Failed to join meeting:', error);
                showNotification('Failed to join meeting: ' + error.message, 'error');
            }
        }

        // Basic platform detection fallback
        function detectBasicPlatform(url) {
            const urlLower = url.toLowerCase();
            if (urlLower.includes('meet.google.com') || urlLower.includes('meet.app.goo.gl')) {
                return 'googleMeet';
            }
            if (urlLower.includes('teams.microsoft.com') || urlLower.includes('teams.live.com')) {
                return 'teams';
            }
            if (urlLower.includes('zoom.us') || urlLower.includes('zoom.com')) {
                return 'zoom';
            }
            return null;
        }

        function showNotification(message, type = 'info') {
            console.log(`📢 ${type.toUpperCase()}: ${message}`);
            // Could implement a toast notification system here
        }

        // Meetings Management Functions
        async function loadMeetings() {
            console.log('Loading meetings...');
            const meetingsList = document.getElementById('meetingsList');
            if (!meetingsList) return;

            // Show loading state
            meetingsList.innerHTML = `
                <div class="loading-state">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading meetings...</p>
                </div>
            `;

            try {
                const meetingsData = await ipcRenderer.invoke('get-platform-meetings');
                console.log('Received meetings data:', meetingsData);
                
                renderMeetings(meetingsData);
            } catch (error) {
                console.error('Failed to load meetings:', error);
                meetingsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Failed to load meetings</p>
                        <p style="font-size: 14px; opacity: 0.7;">${error.message}</p>
                    </div>
                `;
            }
        }

        function renderMeetings(meetingsData) {
            const meetingsList = document.getElementById('meetingsList');
            
            // Count total meetings
            const totalMeetings = Object.values(meetingsData).reduce((sum, meetings) => sum + (meetings?.length || 0), 0);
            
            if (totalMeetings === 0) {
                meetingsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar-times"></i>
                        <p>No upcoming meetings found</p>
                        <p style="font-size: 14px; opacity: 0.7;">Connect your meeting platforms and check back later</p>
                    </div>
                `;
                return;
            }

            let html = '';
            
            // Platform order and display names
            const platforms = [
                { key: 'google-meet', name: 'Google Meet', icon: '📹' },
                { key: 'microsoft-teams', name: 'Microsoft Teams', icon: '💼' },
                { key: 'zoom', name: 'Zoom', icon: '🎥' },
                { key: 'webex', name: 'Cisco Webex', icon: '📞' }
            ];

            platforms.forEach(platform => {
                const meetings = meetingsData[platform.key] || [];
                if (meetings.length > 0) {
                    html += `
                        <div class="platform-section">
                            <div class="platform-header">
                                <span style="font-size: 18px;">${platform.icon}</span>
                                <span class="platform-name">${platform.name}</span>
                                <span style="color: rgba(255,255,255,0.5); font-size: 12px;">(${meetings.length} meeting${meetings.length !== 1 ? 's' : ''})</span>
                            </div>
                            ${meetings.map(meeting => renderMeetingCard(meeting, platform.key)).join('')}
                        </div>
                    `;
                }
            });

            meetingsList.innerHTML = html;
        }

        function renderMeetingCard(meeting, platform) {
            const startTime = meeting.startTime ? new Date(meeting.startTime) : null;
            const endTime = meeting.endTime ? new Date(meeting.endTime) : null;
            
            const timeString = startTime ? 
                startTime.toLocaleDateString() + ' at ' + startTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 
                'Time not specified';
            
            const durationString = startTime && endTime ? 
                ` - ${endTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}` : '';

            return `
                <div class="meeting-card">
                    <div class="meeting-header">
                        <div>
                            <h3 class="meeting-title">${meeting.title || 'Untitled Meeting'}</h3>
                            <span class="meeting-platform ${platform}">${platform.replace('-', ' ')}</span>
                        </div>
                    </div>
                    <div class="meeting-time">
                        <i class="fas fa-clock"></i>
                        <span>${timeString}${durationString}</span>
                    </div>
                    <div class="meeting-actions">
                        ${meeting.joinUrl ? `
                            <button class="meeting-btn primary" onclick="joinMeeting('${meeting.joinUrl}')">
                                <i class="fas fa-video"></i> Join Meeting
                            </button>
                            <button class="meeting-btn" onclick="copyMeetingLink('${meeting.joinUrl}')">
                                <i class="fas fa-copy"></i> Copy Link
                            </button>
                        ` : `
                            <span style="color: rgba(255,255,255,0.5); font-size: 14px;">No join link available</span>
                        `}
                    </div>
                </div>
            `;
        }

        async function refreshMeetings() {
            await loadMeetings();
            showNotification('Meetings refreshed', 'success');
        }

        async function joinMeeting(meetingUrl) {
            try {
                await ipcRenderer.invoke('open-external', meetingUrl);
                showNotification('Opening meeting...', 'success');
            } catch (error) {
                console.error('Failed to open meeting:', error);
                showNotification('Failed to open meeting', 'error');
            }
        }

        async function copyMeetingLink(meetingUrl) {
            try {
                await navigator.clipboard.writeText(meetingUrl);
                showNotification('Meeting link copied to clipboard', 'success');
            } catch (error) {
                console.error('Failed to copy link:', error);
                showNotification('Failed to copy link', 'error');
            }
        }

        async function quickJoinMeeting() {
            const urlInput = document.getElementById('quickJoinUrl');
            const meetingUrl = urlInput.value.trim();
            
            if (!meetingUrl) {
                showNotification('Please enter a meeting URL', 'error');
                return;
            }

            await joinMeeting(meetingUrl);
            urlInput.value = ''; // Clear the input
        }

        // Update Management Functions
        async function checkForUpdates() {
            try {
                showNotification('Checking for updates...', 'info');
                const result = await ipcRenderer.invoke('check-for-updates');
                
                if (result.success) {
                    showNotification(result.message, 'success');
                } else {
                    showNotification(`Update check failed: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Failed to check for updates:', error);
                showNotification('Failed to check for updates', 'error');
            }
        }

        async function openDocumentation() {
            try {
                await ipcRenderer.invoke('open-external', 'https://docs.rembra.com');
            } catch (error) {
                console.error('Failed to open documentation:', error);
                showNotification('Failed to open documentation', 'error');
            }
        }

        async function contactSupport() {
            try {
                await ipcRenderer.invoke('open-external', 'mailto:support@rembra.com');
            } catch (error) {
                console.error('Failed to open support email:', error);
                showNotification('Failed to open support email', 'error');
            }
        }

        document.getElementById('editClientForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await updateClient();
        });

        // Initialize
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('🔍 Settings panel DOM loaded');
            console.log('🔍 ipcRenderer available:', !!ipcRenderer);
            
            // Listen for client updates from ClientManager
            if (ipcRenderer) {
                ipcRenderer.on('clients-updated', () => {
                    console.log('📡 Received clients-updated event');
                    if (currentTab === 'clients') {
                        loadClients();
                    }
                });
            }
            
            // Initialize Firebase first
            try {
                console.log('🔍 Initializing Firebase in settings panel...');
                const { initializeApp } = require('firebase/app');
                const { getAuth } = require('firebase/auth');
                
                // Firebase config (should match your app config)
                const firebaseConfig = {
                    apiKey: "AIzaSyBhoXlAxO9_YdZY9Bdsi9X3oFpJzbC-FKI",
                    authDomain: "ali-website-1674a.firebaseapp.com",
                    projectId: "ali-website-1674a",
                    storageBucket: "ali-website-1674a.firebasestorage.app",
                    messagingSenderId: "1096024812793",
                    appId: "1:1096024812793:web:14ef02289b05cd11ca4628"
                };
                
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                console.log('Firebase initialized in settings panel');
                
                // Wait a bit for auth state to settle
                setTimeout(() => {
                    console.log('🔍 Auth current user:', auth.currentUser);
                    loadUserData();
                }, 500);
                
            } catch (error) {
                console.log('❌ Failed to initialize Firebase in settings:', error);
                // Fallback to normal loading
                setTimeout(() => {
                    loadUserData();
                }, 100);
            }
            
            // Initialize MeetingPlatformManager
            try {
                console.log('🔍 Initializing MeetingPlatformManager...');
                const MeetingPlatformManagerClass = require('../services/MeetingPlatformManager');
                window.MeetingPlatformManager = new MeetingPlatformManagerClass();
                console.log('✅ MeetingPlatformManager initialized successfully');
            } catch (error) {
                console.error('❌ Failed to initialize MeetingPlatformManager:', error);
            }

            // Test IPC immediately
            setTimeout(async () => {
                console.log('🔍 Testing IPC connection...');
                try {
                    const testResult = await ipcRenderer.invoke('test-ipc');
                    console.log('🔍 IPC test result:', testResult);
                } catch (error) {
                    console.error('❌ IPC test failed:', error);
                }
            }, 100);
            
            // Load initial tab content
            switchTab('privacy');
        });
    </script>
</body>
</html>
